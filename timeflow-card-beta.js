function e(e,t,i,s){var r,a=arguments.length,o=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,s);else for(var n=e.length-1;n>=0;n--)(r=e[n])&&(o=(a<3?r(o):a>3?r(t,i,o):r(t,i))||o);return a>3&&o&&Object.defineProperty(t,i,o),o}"function"==typeof SuppressedError&&SuppressedError;const t=globalThis,i=t.ShadowRoot&&(void 0===t.ShadyCSS||t.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,s=Symbol(),r=new WeakMap;let a=class{constructor(e,t,i){if(this._$cssResult$=!0,i!==s)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=t}get styleSheet(){let e=this.o;const t=this.t;if(i&&void 0===e){const i=void 0!==t&&1===t.length;i&&(e=r.get(t)),void 0===e&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),i&&r.set(t,e))}return e}toString(){return this.cssText}};const o=(e,...t)=>{const i=1===e.length?e[0]:t.reduce((t,i,s)=>t+(e=>{if(!0===e._$cssResult$)return e.cssText;if("number"==typeof e)return e;throw Error("Value passed to 'css' function must be a 'css' function result: "+e+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(i)+e[s+1],e[0]);return new a(i,e,s)},n=i?e=>e:e=>e instanceof CSSStyleSheet?(e=>{let t="";for(const i of e.cssRules)t+=i.cssText;return(e=>new a("string"==typeof e?e:e+"",void 0,s))(t)})(e):e,{is:l,defineProperty:c,getOwnPropertyDescriptor:d,getOwnPropertyNames:u,getOwnPropertySymbols:m,getPrototypeOf:h}=Object,p=globalThis,g=p.trustedTypes,f=g?g.emptyScript:"",_=p.reactiveElementPolyfillSupport,v=(e,t)=>e,y={toAttribute(e,t){switch(t){case Boolean:e=e?f:null;break;case Object:case Array:e=null==e?e:JSON.stringify(e)}return e},fromAttribute(e,t){let i=e;switch(t){case Boolean:i=null!==e;break;case Number:i=null===e?null:Number(e);break;case Object:case Array:try{i=JSON.parse(e)}catch(e){i=null}}return i}},b=(e,t)=>!l(e,t),w={attribute:!0,type:String,converter:y,reflect:!1,useDefault:!1,hasChanged:b};Symbol.metadata??=Symbol("metadata"),p.litPropertyMetadata??=new WeakMap;let x=class extends HTMLElement{static addInitializer(e){this._$Ei(),(this.l??=[]).push(e)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(e,t=w){if(t.state&&(t.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(e)&&((t=Object.create(t)).wrapped=!0),this.elementProperties.set(e,t),!t.noAccessor){const i=Symbol(),s=this.getPropertyDescriptor(e,i,t);void 0!==s&&c(this.prototype,e,s)}}static getPropertyDescriptor(e,t,i){const{get:s,set:r}=d(this.prototype,e)??{get(){return this[t]},set(e){this[t]=e}};return{get:s,set(t){const a=s?.call(this);r?.call(this,t),this.requestUpdate(e,a,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)??w}static _$Ei(){if(this.hasOwnProperty(v("elementProperties")))return;const e=h(this);e.finalize(),void 0!==e.l&&(this.l=[...e.l]),this.elementProperties=new Map(e.elementProperties)}static finalize(){if(this.hasOwnProperty(v("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(v("properties"))){const e=this.properties,t=[...u(e),...m(e)];for(const i of t)this.createProperty(i,e[i])}const e=this[Symbol.metadata];if(null!==e){const t=litPropertyMetadata.get(e);if(void 0!==t)for(const[e,i]of t)this.elementProperties.set(e,i)}this._$Eh=new Map;for(const[t,i]of this.elementProperties){const e=this._$Eu(t,i);void 0!==e&&this._$Eh.set(e,t)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(e){const t=[];if(Array.isArray(e)){const i=new Set(e.flat(1/0).reverse());for(const e of i)t.unshift(n(e))}else void 0!==e&&t.push(n(e));return t}static _$Eu(e,t){const i=t.attribute;return!1===i?void 0:"string"==typeof i?i:"string"==typeof e?e.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise(e=>this.enableUpdating=e),this._$AL=new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach(e=>e(this))}addController(e){(this._$EO??=new Set).add(e),void 0!==this.renderRoot&&this.isConnected&&e.hostConnected?.()}removeController(e){this._$EO?.delete(e)}_$E_(){const e=new Map,t=this.constructor.elementProperties;for(const i of t.keys())this.hasOwnProperty(i)&&(e.set(i,this[i]),delete this[i]);e.size>0&&(this._$Ep=e)}createRenderRoot(){const e=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return((e,s)=>{if(i)e.adoptedStyleSheets=s.map(e=>e instanceof CSSStyleSheet?e:e.styleSheet);else for(const i of s){const s=document.createElement("style"),r=t.litNonce;void 0!==r&&s.setAttribute("nonce",r),s.textContent=i.cssText,e.appendChild(s)}})(e,this.constructor.elementStyles),e}connectedCallback(){this.renderRoot??=this.createRenderRoot(),this.enableUpdating(!0),this._$EO?.forEach(e=>e.hostConnected?.())}enableUpdating(e){}disconnectedCallback(){this._$EO?.forEach(e=>e.hostDisconnected?.())}attributeChangedCallback(e,t,i){this._$AK(e,i)}_$ET(e,t){const i=this.constructor.elementProperties.get(e),s=this.constructor._$Eu(e,i);if(void 0!==s&&!0===i.reflect){const r=(void 0!==i.converter?.toAttribute?i.converter:y).toAttribute(t,i.type);this._$Em=e,null==r?this.removeAttribute(s):this.setAttribute(s,r),this._$Em=null}}_$AK(e,t){const i=this.constructor,s=i._$Eh.get(e);if(void 0!==s&&this._$Em!==s){const e=i.getPropertyOptions(s),r="function"==typeof e.converter?{fromAttribute:e.converter}:void 0!==e.converter?.fromAttribute?e.converter:y;this._$Em=s;const a=r.fromAttribute(t,e.type);this[s]=a??this._$Ej?.get(s)??a,this._$Em=null}}requestUpdate(e,t,i){if(void 0!==e){const s=this.constructor,r=this[e];if(i??=s.getPropertyOptions(e),!((i.hasChanged??b)(r,t)||i.useDefault&&i.reflect&&r===this._$Ej?.get(e)&&!this.hasAttribute(s._$Eu(e,i))))return;this.C(e,t,i)}!1===this.isUpdatePending&&(this._$ES=this._$EP())}C(e,t,{useDefault:i,reflect:s,wrapped:r},a){i&&!(this._$Ej??=new Map).has(e)&&(this._$Ej.set(e,a??t??this[e]),!0!==r||void 0!==a)||(this._$AL.has(e)||(this.hasUpdated||i||(t=void 0),this._$AL.set(e,t)),!0===s&&this._$Em!==e&&(this._$Eq??=new Set).add(e))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(e){Promise.reject(e)}const e=this.scheduleUpdate();return null!=e&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??=this.createRenderRoot(),this._$Ep){for(const[e,t]of this._$Ep)this[e]=t;this._$Ep=void 0}const e=this.constructor.elementProperties;if(e.size>0)for(const[t,i]of e){const{wrapped:e}=i,s=this[t];!0!==e||this._$AL.has(t)||void 0===s||this.C(t,void 0,i,s)}}let e=!1;const t=this._$AL;try{e=this.shouldUpdate(t),e?(this.willUpdate(t),this._$EO?.forEach(e=>e.hostUpdate?.()),this.update(t)):this._$EM()}catch(t){throw e=!1,this._$EM(),t}e&&this._$AE(t)}willUpdate(e){}_$AE(e){this._$EO?.forEach(e=>e.hostUpdated?.()),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(e){return!0}update(e){this._$Eq&&=this._$Eq.forEach(e=>this._$ET(e,this[e])),this._$EM()}updated(e){}firstUpdated(e){}};x.elementStyles=[],x.shadowRootOptions={mode:"open"},x[v("elementProperties")]=new Map,x[v("finalized")]=new Map,_?.({ReactiveElement:x}),(p.reactiveElementVersions??=[]).push("2.1.1");const T=globalThis,$=T.trustedTypes,S=$?$.createPolicy("lit-html",{createHTML:e=>e}):void 0,A="$lit$",D=`lit$${Math.random().toFixed(9).slice(2)}$`,C="?"+D,M=`<${C}>`,E=document,I=()=>E.createComment(""),N=e=>null===e||"object"!=typeof e&&"function"!=typeof e,k=Array.isArray,R="[ \t\n\f\r]",z=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,P=/-->/g,O=/>/g,L=RegExp(`>|${R}(?:([^\\s"'>=/]+)(${R}*=${R}*(?:[^ \t\n\f\r"'\`<>=]|("|')|))|$)`,"g"),U=/'/g,H=/"/g,F=/^(?:script|style|textarea|title)$/i,V=(e=>(t,...i)=>({_$litType$:e,strings:t,values:i}))(1),j=Symbol.for("lit-noChange"),W=Symbol.for("lit-nothing"),G=new WeakMap,B=E.createTreeWalker(E,129);function q(e,t){if(!k(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return void 0!==S?S.createHTML(t):t}const K=(e,t)=>{const i=e.length-1,s=[];let r,a=2===t?"<svg>":3===t?"<math>":"",o=z;for(let n=0;n<i;n++){const t=e[n];let i,l,c=-1,d=0;for(;d<t.length&&(o.lastIndex=d,l=o.exec(t),null!==l);)d=o.lastIndex,o===z?"!--"===l[1]?o=P:void 0!==l[1]?o=O:void 0!==l[2]?(F.test(l[2])&&(r=RegExp("</"+l[2],"g")),o=L):void 0!==l[3]&&(o=L):o===L?">"===l[0]?(o=r??z,c=-1):void 0===l[1]?c=-2:(c=o.lastIndex-l[2].length,i=l[1],o=void 0===l[3]?L:'"'===l[3]?H:U):o===H||o===U?o=L:o===P||o===O?o=z:(o=L,r=void 0);const u=o===L&&e[n+1].startsWith("/>")?" ":"";a+=o===z?t+M:c>=0?(s.push(i),t.slice(0,c)+A+t.slice(c)+D+u):t+D+(-2===c?n:u)}return[q(e,a+(e[i]||"<?>")+(2===t?"</svg>":3===t?"</math>":"")),s]};class J{constructor({strings:e,_$litType$:t},i){let s;this.parts=[];let r=0,a=0;const o=e.length-1,n=this.parts,[l,c]=K(e,t);if(this.el=J.createElement(l,i),B.currentNode=this.el.content,2===t||3===t){const e=this.el.content.firstChild;e.replaceWith(...e.childNodes)}for(;null!==(s=B.nextNode())&&n.length<o;){if(1===s.nodeType){if(s.hasAttributes())for(const e of s.getAttributeNames())if(e.endsWith(A)){const t=c[a++],i=s.getAttribute(e).split(D),o=/([.?@])?(.*)/.exec(t);n.push({type:1,index:r,name:o[2],strings:i,ctor:"."===o[1]?ee:"?"===o[1]?te:"@"===o[1]?ie:Q}),s.removeAttribute(e)}else e.startsWith(D)&&(n.push({type:6,index:r}),s.removeAttribute(e));if(F.test(s.tagName)){const e=s.textContent.split(D),t=e.length-1;if(t>0){s.textContent=$?$.emptyScript:"";for(let i=0;i<t;i++)s.append(e[i],I()),B.nextNode(),n.push({type:2,index:++r});s.append(e[t],I())}}}else if(8===s.nodeType)if(s.data===C)n.push({type:2,index:r});else{let e=-1;for(;-1!==(e=s.data.indexOf(D,e+1));)n.push({type:7,index:r}),e+=D.length-1}r++}}static createElement(e,t){const i=E.createElement("template");return i.innerHTML=e,i}}function Y(e,t,i=e,s){if(t===j)return t;let r=void 0!==s?i._$Co?.[s]:i._$Cl;const a=N(t)?void 0:t._$litDirective$;return r?.constructor!==a&&(r?._$AO?.(!1),void 0===a?r=void 0:(r=new a(e),r._$AT(e,i,s)),void 0!==s?(i._$Co??=[])[s]=r:i._$Cl=r),void 0!==r&&(t=Y(e,r._$AS(e,t.values),r,s)),t}class Z{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){const{el:{content:t},parts:i}=this._$AD,s=(e?.creationScope??E).importNode(t,!0);B.currentNode=s;let r=B.nextNode(),a=0,o=0,n=i[0];for(;void 0!==n;){if(a===n.index){let t;2===n.type?t=new X(r,r.nextSibling,this,e):1===n.type?t=new n.ctor(r,n.name,n.strings,this,e):6===n.type&&(t=new se(r,this,e)),this._$AV.push(t),n=i[++o]}a!==n?.index&&(r=B.nextNode(),a++)}return B.currentNode=E,s}p(e){let t=0;for(const i of this._$AV)void 0!==i&&(void 0!==i.strings?(i._$AI(e,i,t),t+=i.strings.length-2):i._$AI(e[t])),t++}}class X{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(e,t,i,s){this.type=2,this._$AH=W,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=i,this.options=s,this._$Cv=s?.isConnected??!0}get parentNode(){let e=this._$AA.parentNode;const t=this._$AM;return void 0!==t&&11===e?.nodeType&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=Y(this,e,t),N(e)?e===W||null==e||""===e?(this._$AH!==W&&this._$AR(),this._$AH=W):e!==this._$AH&&e!==j&&this._(e):void 0!==e._$litType$?this.$(e):void 0!==e.nodeType?this.T(e):(e=>k(e)||"function"==typeof e?.[Symbol.iterator])(e)?this.k(e):this._(e)}O(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.O(e))}_(e){this._$AH!==W&&N(this._$AH)?this._$AA.nextSibling.data=e:this.T(E.createTextNode(e)),this._$AH=e}$(e){const{values:t,_$litType$:i}=e,s="number"==typeof i?this._$AC(e):(void 0===i.el&&(i.el=J.createElement(q(i.h,i.h[0]),this.options)),i);if(this._$AH?._$AD===s)this._$AH.p(t);else{const e=new Z(s,this),i=e.u(this.options);e.p(t),this.T(i),this._$AH=e}}_$AC(e){let t=G.get(e.strings);return void 0===t&&G.set(e.strings,t=new J(e)),t}k(e){k(this._$AH)||(this._$AH=[],this._$AR());const t=this._$AH;let i,s=0;for(const r of e)s===t.length?t.push(i=new X(this.O(I()),this.O(I()),this,this.options)):i=t[s],i._$AI(r),s++;s<t.length&&(this._$AR(i&&i._$AB.nextSibling,s),t.length=s)}_$AR(e=this._$AA.nextSibling,t){for(this._$AP?.(!1,!0,t);e!==this._$AB;){const t=e.nextSibling;e.remove(),e=t}}setConnected(e){void 0===this._$AM&&(this._$Cv=e,this._$AP?.(e))}}class Q{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,t,i,s,r){this.type=1,this._$AH=W,this._$AN=void 0,this.element=e,this.name=t,this._$AM=s,this.options=r,i.length>2||""!==i[0]||""!==i[1]?(this._$AH=Array(i.length-1).fill(new String),this.strings=i):this._$AH=W}_$AI(e,t=this,i,s){const r=this.strings;let a=!1;if(void 0===r)e=Y(this,e,t,0),a=!N(e)||e!==this._$AH&&e!==j,a&&(this._$AH=e);else{const s=e;let o,n;for(e=r[0],o=0;o<r.length-1;o++)n=Y(this,s[i+o],t,o),n===j&&(n=this._$AH[o]),a||=!N(n)||n!==this._$AH[o],n===W?e=W:e!==W&&(e+=(n??"")+r[o+1]),this._$AH[o]=n}a&&!s&&this.j(e)}j(e){e===W?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}}class ee extends Q{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===W?void 0:e}}class te extends Q{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==W)}}class ie extends Q{constructor(e,t,i,s,r){super(e,t,i,s,r),this.type=5}_$AI(e,t=this){if((e=Y(this,e,t,0)??W)===j)return;const i=this._$AH,s=e===W&&i!==W||e.capture!==i.capture||e.once!==i.once||e.passive!==i.passive,r=e!==W&&(i===W||s);s&&this.element.removeEventListener(this.name,this,i),r&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){"function"==typeof this._$AH?this._$AH.call(this.options?.host??this.element,e):this._$AH.handleEvent(e)}}class se{constructor(e,t,i){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=i}get _$AU(){return this._$AM._$AU}_$AI(e){Y(this,e)}}const re=T.litHtmlPolyfillSupport;re?.(J,X),(T.litHtmlVersions??=[]).push("3.3.1");const ae=globalThis;let oe=class extends x{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){const e=super.createRenderRoot();return this.renderOptions.renderBefore??=e.firstChild,e}update(e){const t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=((e,t,i)=>{const s=i?.renderBefore??t;let r=s._$litPart$;if(void 0===r){const e=i?.renderBefore??null;s._$litPart$=r=new X(t.insertBefore(I(),e),e,void 0,i??{})}return r._$AI(e),r})(t,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return j}};oe._$litElement$=!0,oe.finalized=!0,ae.litElementHydrateSupport?.({LitElement:oe});const ne=ae.litElementPolyfillSupport;ne?.({LitElement:oe}),(ae.litElementVersions??=[]).push("4.2.1");const le={attribute:!0,type:String,converter:y,reflect:!1,hasChanged:b},ce=(e=le,t,i)=>{const{kind:s,metadata:r}=i;let a=globalThis.litPropertyMetadata.get(r);if(void 0===a&&globalThis.litPropertyMetadata.set(r,a=new Map),"setter"===s&&((e=Object.create(e)).wrapped=!0),a.set(i.name,e),"accessor"===s){const{name:s}=i;return{set(i){const r=t.get.call(this);t.set.call(this,i),this.requestUpdate(s,r,e)},init(t){return void 0!==t&&this.C(s,void 0,e,t),t}}}if("setter"===s){const{name:s}=i;return function(i){const r=this[s];t.call(this,i),this.requestUpdate(s,r,e)}}throw Error("Unsupported decorator location: "+s)};function de(e){return(t,i)=>"object"==typeof i?ce(e,t,i):((e,t,i)=>{const s=t.hasOwnProperty(i);return t.constructor.createProperty(i,e),s?Object.getOwnPropertyDescriptor(t,i):void 0})(e,t,i)}function ue(e){return de({...e,state:!0,attribute:!1})}class me{static getStandardTimerData(e,t,i){const s=t.state,r=t.attributes,a="active"===s,o="paused"===s,n="idle"===s;let l=0;r.duration&&(l=i(r.duration));let c=0,d=null;(a||o)&&(r.finishes_at?(d=new Date(r.finishes_at),isNaN(d.getTime())||(c=Math.max(0,Math.floor((d.getTime()-Date.now())/1e3)))):r.remaining&&(c=i(r.remaining)));let u=0;if(l>0)if(n)u=0;else{const e=l-c;u=Math.min(100,Math.max(0,e/l*100))}return{isActive:a,isPaused:o,duration:l,remaining:c,finishesAt:d,progress:u,isAlexaTimer:!1}}}class he{static getAlexaTimerData(e,t,i,s,r){var a,o,n,l,c,d,u,m,h;const{state:p,attributes:g}=t,f=null!==(a=this.parseJson(g.sorted_active))&&void 0!==a?a:[],_=null!==(o=this.parseJson(g.sorted_all))&&void 0!==o?o:[],v=null!==(l=null!==(n=g.total_active)&&void 0!==n?n:f.length)&&void 0!==l?l:0,y=null!==(d=null!==(c=g.total_all)&&void 0!==c?c:_.length)&&void 0!==d?d:0,b=new Map;for(const z of f){const e=this.extractTimerEntry(z);e&&b.set(e.id,e.data)}const w=new Map;for(const z of _){const e=this.extractTimerEntry(z);e&&w.set(e.id,e.data)}const x=Date.now();let T=this.alexaIdCache.get(e);T||(T={},this.alexaIdCache.set(e,T));const $=[];for(const[z,P]of b.entries()){const e="number"==typeof(null==P?void 0:P.triggerTime)?P.triggerTime:0;e&&e<=x&&$.push({id:z,trig:e})}$.length>0?($.sort((e,t)=>e.trig-t.trig),T.finishedWhileActiveId=$[0].id):T.finishedWhileActiveId&&!b.has(T.finishedWhileActiveId)&&delete T.finishedWhileActiveId;let S,A=!1,D=!1,C=!1,M=null;if(v>0&&f.length>0)if(T.finishedWhileActiveId&&b.has(T.finishedWhileActiveId))S=T.finishedWhileActiveId,M=null!==(u=b.get(S))&&void 0!==u?u:null,A=!!M,C=!0;else{if(1===f.length){const e=this.extractTimerEntry(f[0]);S=null==e?void 0:e.id,M=null!==(m=null==e?void 0:e.data)&&void 0!==m?m:null}else{let e,t=null,i=Number.POSITIVE_INFINITY;for(const s of f){const r=this.extractTimerEntry(s);r&&"number"==typeof(null===(h=r.data)||void 0===h?void 0:h.remainingTime)&&r.data.remainingTime<i&&(i=r.data.remainingTime,t=r.data,e=r.id)}S=e,M=t}A=!!M,A&&M&&"number"==typeof M.triggerTime&&M.triggerTime<=x&&(C=!0,T.finishedWhileActiveId=S)}else if(y>0&&_.length>0){let e=null,t=-1/0;for(const[i,s]of w.entries())if("PAUSED"===(null==s?void 0:s.status)){const r="number"==typeof s.lastUpdatedDate?s.lastUpdatedDate:-1/0;r>t&&(t=r,e=s,S=i)}e&&(M=e,D=!0)}let E=0,I=0,N=null,k=0;if(M){const e=Date.now(),t="number"==typeof M.remainingTime?M.remainingTime:0,i="number"==typeof M.originalDurationInMillis?M.originalDurationInMillis:0,s="number"==typeof M.triggerTime?M.triggerTime:0;if(I=Math.max(0,Math.floor(i/1e3)),A?(s&&s>e?(E=Math.max(0,Math.floor((s-e)/1e3)),N=new Date(s)):(E=Math.max(0,Math.floor(t/1e3)),E>0&&(N=new Date(e+1e3*E))),(s&&s<=e||E<=0||"OFF"===M.status&&0===t)&&(E=0,N=null,C=!0)):(E=Math.max(0,Math.floor(t/1e3)),N=null),I>0){const e=Math.max(0,I-E);k=Math.min(100,Math.max(0,e/I*100)),A&&k>=100&&(E=0,C=!0)}}else{if(p&&"unavailable"!==p&&"unknown"!==p&&(s(p)?(N=new Date(p),isNaN(N.getTime())||(E=Math.max(0,Math.floor((N.getTime()-Date.now())/1e3)))):isNaN(parseFloat(p))?"string"==typeof p&&p.includes(":")&&(E=r(p)):E=Math.max(0,parseFloat(p))),g.original_duration)I=r(g.original_duration);else if(g.duration)I=r(g.duration);else if(N&&t.last_changed){const e=new Date(t.last_changed).getTime(),i=N.getTime();!isNaN(e)&&i>e&&(I=Math.floor((i-e)/1e3))}if(I>0){const e=I-E;k=Math.min(100,Math.max(0,e/I*100))}}let R=this.extractTimerLabel(M);if(!R&&f.length>0){const e=this.extractTimerEntry(f[0]);R=this.extractTimerLabel(null==e?void 0:e.data)}if(!R&&_.length>0){const e=this.extractTimerEntry(_[0]);R=this.extractTimerLabel(null==e?void 0:e.data)}return{isActive:A,isPaused:D,duration:I,remaining:E,finishesAt:N,progress:k,finished:C,isAlexaTimer:!0,alexaDevice:this.extractAlexaDevice(e,g),timerLabel:null!=R?R:this.extractAlexaDevice(e,g),timerStatus:D?"PAUSED":A?"ON":"OFF",userDefinedLabel:R}}static parseLegacyAlexaTimer(e,t,i,s,r,a){let o=0,n=0,l=null,c=!1;if(i&&"unavailable"!==i&&"unknown"!==i)if(r(i)){if(l=new Date(i),!isNaN(l.getTime())){const e=Date.now();o=Math.max(0,Math.floor((l.getTime()-e)/1e3)),c=o>0}}else isNaN(parseFloat(i))?"string"==typeof i&&i.includes(":")&&(o=a(i),c=o>0):(o=Math.max(0,parseFloat(i)),c=o>0);let d=!1;if(s.original_duration)n=a(s.original_duration),d=!0;else if(s.duration)n=a(s.duration),d=!0;else if(l&&t.last_changed){const e=new Date(t.last_changed).getTime(),i=l.getTime();!isNaN(e)&&i>e&&(n=Math.floor((i-e)/1e3),d=!0)}d||(n=o>0?o:0,d=!1);let u=0;if(d&&n>0)if(c&&o>=0){const e=n-o;u=Math.min(100,Math.max(0,e/n*100))}else 0===o&&n>0&&(u=100);else if(c&&o>0){const e=t.last_changed?new Date(t.last_changed).getTime():Date.now(),i=(Date.now()-e)/1e3;if(i<o){const e=o+i,t=i;u=Math.min(100,Math.max(0,t/e*100))}else u=0}else u=0;return{isActive:c,isPaused:!1,duration:n,remaining:o,finishesAt:l,progress:u,isAlexaTimer:!0,alexaDevice:this.extractAlexaDevice(e,s),timerLabel:s.friendly_name||s.timer_label||this.formatAlexaTimerName(e),timerStatus:c?"ON":"OFF",userDefinedLabel:void 0}}static discoverAlexaTimers(e,t,i){var s,r;if(!e||!e.states)return[];const a=[];for(const o in e.states)if(t(o)){const t=e.states[o].attributes||{},n=null!==(s=this.parseJson(t.sorted_active))&&void 0!==s?s:[],l=null!==(r=this.parseJson(t.sorted_all))&&void 0!==r?r:[],c=Array.isArray(n)&&n.length>0;let d=!1;if(!c&&Array.isArray(l)&&l.length>0)for(const e of l){const t=this.extractTimerEntry(e),i=null==t?void 0:t.data;if(i&&"PAUSED"===i.status&&"number"==typeof i.remainingTime&&i.remainingTime>0){d=!0;break}}if(c||d){a.push(o);continue}const u=i(o,e);u&&(u.isActive||u.isPaused)&&a.push(o)}return a}static parseJson(e){if(Array.isArray(e))return e;if("string"==typeof e)try{return JSON.parse(e)}catch{}return null}static extractTimerEntry(e){return e&&"object"==typeof e&&!Array.isArray(e)&&e.id?{id:String(e.id),data:e}:Array.isArray(e)&&e.length>=2&&e[0]&&e[1]?{id:String(e[0]),data:e[1]}:null}static extractTimerLabel(e){if(e)return e.timerLabel?e.timerLabel:e.label?e.label:void 0}static extractAlexaDevice(e,t){if(t.friendly_name){let e=t.friendly_name;if(e=e.replace(/\s*next\s*timer$/i,"").replace(/\s*timer$/i,"").replace(/\s*echo\s*timer$/i,"").replace(/\s*alexa\s*timer$/i,"").trim(),e)return e}if(e.includes("_next_timer")){const t=e.replace(/^sensor\./,"").replace(/_next_timer$/,"").replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase());if(t)return t}return t.device_name?t.device_name:t.device?t.device:"Alexa Device"}static formatAlexaTimerName(e){return e.replace(/^sensor\./,"").replace(/_next_timer$/,"").replace(/_timer$/,"").replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())}}he.alexaIdCache=new Map;class pe{static getGoogleTimerData(e,t,i,s){const{state:r,attributes:a}=t,o=a.timers||[];if(!Array.isArray(o)||0===o.length){const t=this.googleIdCache.get(e);return(null==t?void 0:t.finishedTimerId)&&(delete t.finishedTimerId,delete t.lastDuration,delete t.lastLabel),{isActive:!1,isPaused:!1,duration:0,remaining:0,finishesAt:null,progress:0,finished:!1,isGoogleTimer:!0,userDefinedLabel:void 0,googleTimerId:void 0,googleTimerStatus:"none"}}const n=new Map,l=new Map;for(const S of o)S.timer_id&&(l.set(String(S.timer_id),S),"set"!==S.status&&"ringing"!==S.status||n.set(String(S.timer_id),S));const c=Date.now()/1e3;let d=this.googleIdCache.get(e);d||(d={},this.googleIdCache.set(e,d));const u=[];for(const[S,A]of n.entries())A.fire_time&&A.fire_time<=c&&"ringing"!==A.status&&u.push({id:S,fireTime:A.fire_time,timer:A});for(const S of o)if(S.timer_id&&"ringing"===S.status){const e=String(S.timer_id),t=S.fire_time||c-1;u.push({id:e,fireTime:t,timer:S})}if(u.length>0){u.sort((e,t)=>t.fireTime-e.fireTime),d.finishedTimerId=u[0].id;const e=u[0].timer;e&&(d.lastDuration=e.duration||0,d.lastLabel=e.label||"Timer")}if(d.finishedTimerId){o.some(e=>String(e.timer_id)===d.finishedTimerId)||(delete d.finishedTimerId,delete d.lastDuration,delete d.lastLabel)}let m=null,h=null;for(const S of o)if(S.timer_id&&"ringing"===S.status)return{isActive:!1,isPaused:!1,duration:S.duration||0,remaining:0,finishesAt:null,progress:100,finished:!0,isGoogleTimer:!0,userDefinedLabel:S.label||void 0,googleTimerId:String(S.timer_id),googleTimerStatus:"ringing"};if(d.finishedTimerId&&l.has(d.finishedTimerId)){const e=l.get(d.finishedTimerId);if(e&&e.fire_time<=c)return{isActive:!1,isPaused:!1,duration:e.duration||0,remaining:0,finishesAt:null,progress:100,finished:!0,isGoogleTimer:!0,userDefinedLabel:e.label||void 0,googleTimerId:String(e.timer_id),googleTimerStatus:e.status||"ringing"}}let p=Number.POSITIVE_INFINITY;for(const[S,A]of n.entries())A.fire_time&&A.fire_time<p&&(p=A.fire_time,m=A,h=S);if(!m)for(const S of o)if(S.timer_id){if("paused"===String(S.status||"").toLowerCase().trim()){m=S,h=String(S.timer_id);break}}if(!m){if(!(o.length>0))return null;m=o[0],h=String(o[0].timer_id||"unknown")}const g=String(m.status||"").toLowerCase().trim(),f="set"===g||"ringing"===g,_="paused"===g,v="ringing"===g,y="number"==typeof m.duration?m.duration:s(m.duration||"0");let b=0,w=null,x=!1;d.pausedSnapshots||(d.pausedSnapshots=new Map);const T=d.pausedSnapshots.get(h);if(f){const e=m.fire_time?1e3*m.fire_time:0;e&&e>Date.now()?(b=Math.max(0,Math.floor((e-Date.now())/1e3)),w=new Date(e),d.pausedSnapshots.set(h,{remaining:b,pausedAt:c,wasActive:!0})):(b=0,w=null,x=!0)}else _?(b=T?T.remaining:y,d.pausedSnapshots.set(h,{remaining:b,pausedAt:c,wasActive:!1}),w=null):(b=0,w=null,x=!0);let $=0;if(y>0)if(v||x||0===b&&!_)$=100;else{const e=Math.max(0,y-b);$=Math.min(100,Math.max(0,e/y*100))}return x||(x=v||0===b&&!_),d.pausedSnapshots&&h&&(x||f)&&(f&&!1===(null==T?void 0:T.wasActive)||x)&&d.pausedSnapshots.delete(h),{isActive:f&&!v,isPaused:_,duration:y,remaining:b,finishesAt:w,progress:$,finished:x,isGoogleTimer:!0,userDefinedLabel:m.label||void 0,googleTimerId:h||void 0,googleTimerStatus:m.status}}static discoverGoogleTimers(e,t,i){if(!e||!e.states)return[];const s=[];for(const r in e.states)if(t(r)){const t=(e.states[r].attributes||{}).timers||[];if(Array.isArray(t)&&t.length>0){t.some(e=>{const t=String(e.status||"").toLowerCase().trim();return"set"===t||"ringing"===t||"paused"===t})&&s.push(r)}}return s}static clearFinishedTimer(e){const t=this.googleIdCache.get(e);t&&t.finishedTimerId&&(delete t.finishedTimerId,delete t.lastDuration,delete t.lastLabel)}}pe.googleIdCache=new Map;class ge{static isTimerEntity(e){return!!e&&(!!e.startsWith("timer.")||(!!(e.includes("_next_timer")||e.includes("alexa_timer")||e.startsWith("sensor.")&&e.includes("timer"))||(!(!e.startsWith("sensor.")||!e.endsWith("_timers"))||!(!e.includes("google_home")||!e.includes("timer")))))}static isAlexaTimer(e){return e.includes("_next_timer")||e.includes("alexa_timer")||e.startsWith("sensor.")&&e.includes("alexa")&&e.includes("timer")}static isGoogleTimer(e){return!(!e.startsWith("sensor.")||!e.endsWith("_timers"))||e.includes("google_home")&&e.includes("timer")}static getTimerData(e,t){if(!t||!e||!this.isTimerEntity(e))return null;const i=t.states[e];return i?this.isAlexaTimer(e)?he.getAlexaTimerData(e,i,t,this.isISOTimestamp,this.parseDuration):this.isGoogleTimer(e)?pe.getGoogleTimerData(e,i,t,this.parseDuration):me.getStandardTimerData(e,i,this.parseDuration):null}static discoverAlexaTimers(e){return he.discoverAlexaTimers(e,e=>this.isAlexaTimer(e),(e,t)=>this.getTimerData(e,t))}static discoverGoogleTimers(e){return pe.discoverGoogleTimers(e,e=>this.isGoogleTimer(e),(e,t)=>this.getTimerData(e,t))}static isISOTimestamp(e){return/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d{3})?([+-]\d{2}:\d{2}|Z)?$/.test(e)}static parseDuration(e){if("number"==typeof e)return e;if("string"!=typeof e)return 0;if(e.includes(":")){const t=e.split(":").map(Number);if(3===t.length)return 3600*t[0]+60*t[1]+t[2];if(2===t.length)return 60*t[0]+t[1]}const t=parseFloat(e);return isNaN(t)?0:t}static formatRemainingTime(e,t=!0,i,s=!0){if(e<=0)return"0:00";const r=Math.floor(e/3600),a=Math.floor(e%3600/60),o=Math.floor(e%60);if(s){const e=i?i("time.hour_compact"):"h",s=i?i("time.minute_compact"):"m",n=i?i("time.second_compact"):"s";return r>0?t?`${r}${e} ${a.toString().padStart(2,"0")}${s} ${o.toString().padStart(2,"0")}${n}`:`${r}${e} ${a.toString().padStart(2,"0")}${s}`:t?`${a}${s} ${o.toString().padStart(2,"0")}${n}`:`${a}${s}`}{const e=[];if(r>0){const t=i?i(1===r?"time.hour_full":"time.hours_full"):1===r?"hour":"hours";e.push(`${r} ${t}`)}if(a>0){const t=i?i(1===a?"time.minute_full":"time.minutes_full"):1===a?"minute":"minutes";e.push(`${a} ${t}`)}if(t&&o>0){const t=i?i(1===o?"time.second_full":"time.seconds_full"):1===o?"second":"seconds";e.push(`${o} ${t}`)}return 0===e.length?"0 "+(i?i("time.minutes_full"):"minutes"):e.join(" ")}}static getTimerTitle(e,t,i){if(i)return i;if(!t||!e)return"Timer";const s=t.states[e];if(!s)return"Timer";if(this.isAlexaTimer(e)){const i=he.getAlexaTimerData(e,s,t,this.isISOTimestamp,this.parseDuration);return(null==i?void 0:i.timerLabel)?i.timerLabel:this.formatAlexaTimerName(e)}if(this.isGoogleTimer(e)){const i=pe.getGoogleTimerData(e,s,t,this.parseDuration);return(null==i?void 0:i.userDefinedLabel)?i.userDefinedLabel:this.formatGoogleTimerName(e)}return s.attributes.friendly_name||e.replace("timer.","").replace(/_/g," ")}static formatAlexaTimerName(e){return e.replace(/^sensor\./,"").replace(/_next_timer$/,"").replace(/_timer$/,"").replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())}static formatGoogleTimerName(e){return e.replace(/^sensor\./,"").replace(/_timers$/,"").replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())+" Timers"}static isTimerExpired(e){return!!e&&(e.isAlexaTimer||e.isGoogleTimer?!!e.finished||0===e.remaining&&e.progress>=100:!e.isActive&&!e.isPaused&&e.progress>=100)}static getTimerSubtitle(e,t=!0,i,s=!0){if(!e)return"Timer not found";const r=i||(e=>e);if(e.isAlexaTimer){if(e.finished)return e.userDefinedLabel?r("timer.complete_with_label",{label:e.userDefinedLabel}):r("timer.complete");if(e.isActive&&e.remaining>0){const a=this.formatRemainingTime(e.remaining,t,i,s);return e.userDefinedLabel?r("timer.remaining_with_label",{time:a,label:e.userDefinedLabel}):e.alexaDevice?r("timer.remaining_with_device",{time:a,device:e.alexaDevice}):r("timer.remaining",{time:a})}if(e.isPaused&&e.remaining>0){const a=this.formatRemainingTime(e.remaining,t,i,s);return e.userDefinedLabel?r("timer.paused_with_time",{label:e.userDefinedLabel,time:a}):e.alexaDevice?r("timer.paused_alexa",{device:e.alexaDevice,time:a}):r("timer.paused_without_label",{time:a})}return e.finished||0===e.remaining&&e.progress>=100?e.userDefinedLabel?r("timer.complete_with_label",{label:e.userDefinedLabel}):r("timer.complete"):e.alexaDevice?r("timer.no_timers_device",{device:e.alexaDevice}):r("timer.no_timers")}if(e.isGoogleTimer){const a="ringing"===e.googleTimerStatus;if(e.finished||a)return e.userDefinedLabel?r("timer.complete_with_label",{label:e.userDefinedLabel}):r("timer.complete");if(e.isActive&&e.remaining>0){const a=this.formatRemainingTime(e.remaining,t,i,s);return e.userDefinedLabel?r("timer.remaining_with_label",{time:a,label:e.userDefinedLabel}):r("timer.remaining_with_device",{time:a,device:"Google Home"})}if(e.isPaused&&e.remaining>0){const a=this.formatRemainingTime(e.remaining,t,i,s);return e.userDefinedLabel?r("timer.paused_with_time",{label:e.userDefinedLabel,time:a}):r("timer.google_paused",{time:a})}return e.finished||a||0===e.remaining&&e.progress>=100?e.userDefinedLabel?r("timer.complete_with_label",{label:e.userDefinedLabel}):r("timer.complete"):r("timer.no_timers_google")}return e.isActive?r("timer.remaining",{time:this.formatRemainingTime(e.remaining,t,i,s)}):e.isPaused?r("timer.paused_time_left",{time:this.formatRemainingTime(e.remaining,t,i,s)}):e.duration>0?r("timer.ready_with_time",{time:this.formatRemainingTime(e.duration,t,i,s)}):r("timer.timer_ready")}static getTimerStateColor(e,t="#4caf50"){return e?e.isAlexaTimer?e.isActive&&e.remaining>0?"#00d4ff":this.isTimerExpired(e)?"#ff4444":"#888888":e.isGoogleTimer?e.isActive&&e.remaining>0?"#34a853":this.isTimerExpired(e)?"#ff4444":"#888888":e.isActive?"#4caf50":e.isPaused?"#ff9800":this.isTimerExpired(e)?"#f44336":"#9e9e9e":t}}class fe{static parseISODate(e){try{const t=this.parseISODateManual(e);if(!isNaN(t))return t}catch(i){}const t=new Date(e);return!isNaN(t.getTime())&&this.isValidDateResult(t,e)?t.getTime():this.parseISODateFallback(e)}static isValidDateResult(e,t){const i=e.getTime(),s=new Date("1970-01-01").getTime(),r=new Date("2100-12-31").getTime();if(i<s||i>r)return!1;if("string"==typeof t&&t.includes("02-29")){const t=e.getFullYear();if(!this.isLeapYear(t))return!1}return!0}static isLeapYear(e){return e%4==0&&e%100!=0||e%400==0}static parseISODateManual(e){if("string"==typeof e&&e.includes("T")){if(/[+-]\d{2}:\d{2}$|Z$/.test(e))return new Date(e).getTime();{const[t,i]=e.split("T"),[s,r,a]=t.split("-").map(Number);if(!this.isValidDateComponents(s,r,a))throw new Error("Invalid date components");if(i&&i.includes(":")){const[e,t,o]=i.split(":").map(parseFloat);if(!this.isValidTimeComponents(e,t,o))throw new Error("Invalid time components");return new Date(s,r-1,a,e,t,o||0).getTime()}return new Date(s,r-1,a).getTime()}}return new Date(e).getTime()}static isValidDateComponents(e,t,i){if(isNaN(e)||isNaN(t)||isNaN(i))return!1;if(e<1970||e>2100)return!1;if(t<1||t>12)return!1;if(i<1||i>31)return!1;return!(i>[31,this.isLeapYear(e)?29:28,31,30,31,30,31,31,30,31,30,31][t-1])}static isValidTimeComponents(e,t,i){const s=parseInt(e),r=parseInt(t),a=parseInt(i);return!(isNaN(s)||isNaN(r)||isNaN(a))&&(!(s<0||s>23)&&(!(r<0||r>59)&&!(a<0||a>59)))}static parseISODateFallback(e){try{const t=Date.parse(e);return isNaN(t)?Date.now():t}catch(t){return Date.now()}}}class _e{static validateConfig(e){const t=[];if(!e)return t.push({field:"config",message:"Configuration object is missing or empty",severity:"critical",suggestion:"Provide a valid configuration object with at least a target_date field.",value:e}),{isValid:!1,errors:t,hasCriticalErrors:!0,hasWarnings:!1};e.target_date?this.isValidDateInput(e.target_date)||t.push({field:"target_date",message:"Invalid target_date format",severity:"critical",suggestion:'Use ISO date string (2025-12-31T23:59:59), entity ID (sensor.my_date), or template ({{ states("sensor.date") }}).',value:e.target_date}):e.timer_entity||e.auto_discover_alexa||e.auto_discover_google||t.push({field:"target_date",message:'Either "target_date", "timer_entity", "auto_discover_alexa", or "auto_discover_google" must be provided',severity:"critical",suggestion:'Add target_date field with a valid date value like "2025-12-31T23:59:59" OR specify a timer_entity like "timer.my_timer" OR enable auto_discover_alexa OR enable auto_discover_google.',value:void 0}),e.timer_entity&&!this.isValidEntityId(e.timer_entity)&&t.push({field:"timer_entity",message:"Invalid timer_entity format",severity:"warning",suggestion:'Use a valid entity ID like "timer.my_timer", "sensor.alexa_timer", or "sensor.kitchen_display_timers" (Google Home).',value:e.timer_entity}),e.creation_date&&!this.isValidDateInput(e.creation_date)&&t.push({field:"creation_date",message:"Invalid creation_date format",severity:"warning",suggestion:"Use ISO date string, entity ID, or template. This field is optional.",value:e.creation_date});["text_color","background_color","progress_color"].forEach(i=>{e[i]&&!this.isValidColorInput(e[i])&&t.push({field:i,message:`Invalid ${i} format`,severity:"warning",suggestion:"Use hex (#ff0000), rgb/rgba, hsl/hsla, CSS color name, entity ID, or template.",value:e[i]})});["width","height","icon_size"].forEach(i=>{e[i]&&!this.isValidDimensionInput(e[i])&&t.push({field:i,message:`Invalid ${i} format`,severity:"warning",suggestion:"Use pixel values (100px), percentages (50%), or CSS units (2rem).",value:e[i]})}),e.aspect_ratio&&!this.isValidAspectRatioInput(e.aspect_ratio)&&t.push({field:"aspect_ratio",message:"Invalid aspect_ratio format",severity:"warning",suggestion:'Use format like "16/9", "4/3", or "1/1".',value:e.aspect_ratio}),void 0===e.stroke_width||this.isValidNumberInput(e.stroke_width,1,50)||t.push({field:"stroke_width",message:"Invalid stroke_width value",severity:"warning",suggestion:"Must be a number between 1 and 50.",value:e.stroke_width});["show_months","show_days","show_hours","show_minutes","show_seconds","expired_animation","show_progress_text"].forEach(i=>{void 0===e[i]||this.isValidBooleanInput(e[i])||t.push({field:i,message:`Invalid ${i} value`,severity:"warning",suggestion:"Must be true or false (boolean value).",value:e[i]})});["title","subtitle","expired_text"].forEach(i=>{e[i]&&!this.isValidTextInput(e[i])&&t.push({field:i,message:`Invalid ${i} - contains potentially unsafe content`,severity:"critical",suggestion:"Remove script tags, javascript: URLs, and event handlers for security.",value:e[i]})}),e.styles&&!this.isValidStylesInput(e.styles)&&t.push({field:"styles",message:"Invalid styles object structure",severity:"warning",suggestion:"Must contain valid style arrays for card, title, subtitle, or progress_circle.",value:e.styles}),this._addHelpfulValidations(e,t);const i=this._generateSafeConfig(e,t),s=t.filter(e=>"critical"===e.severity),r=t.filter(e=>"warning"===e.severity);return{isValid:0===s.length&&0===r.length,errors:t,hasCriticalErrors:s.length>0,hasWarnings:r.length>0,safeConfig:i}}static _addHelpfulValidations(e,t){}static _generateSafeConfig(e,t){const i={...e};return t.forEach(e=>{if("critical"===e.severity||"warning"===e.severity)switch(e.field){case"target_date":if(!(i.target_date||i.timer_entity||i.auto_discover_alexa||i.auto_discover_google)){const e=new Date;e.setDate(e.getDate()+1),i.target_date=e.toISOString()}break;case"background_color":this.isValidColorInput(i.background_color)||(i.background_color="#1a1a1a");break;case"progress_color":this.isValidColorInput(i.progress_color)||(i.progress_color="#4caf50");break;case"stroke_width":this.isValidNumberInput(i.stroke_width,1,50)||(i.stroke_width=15);break;case"icon_size":this.isValidDimensionInput(i.icon_size)||(i.icon_size=100)}}),i}static validateConfigLegacy(e){const t=this.validateConfig(e);if(t.hasCriticalErrors){const e=t.errors.filter(e=>"critical"===e.severity);throw new Error(`Configuration validation failed:\nâ€¢ ${e.map(e=>e.message).join("\nâ€¢ ")}`)}}static isValidDateInput(e){if(!e)return!1;if(this.isTemplate(e))return!0;if("string"==typeof e&&e.includes("."))return!0;if("string"==typeof e)try{const t=new Date(e);return!isNaN(t.getTime())}catch(t){return!1}return!1}static isValidColorInput(e){if(!e)return!1;if(this.isTemplate(e)||"string"==typeof e&&e.includes("."))return!0;if("string"!=typeof e)return!1;if(/^#([0-9A-F]{3}){1,2}$/i.test(e))return!0;if(/^rgba?\(\s*\d+\s*,\s*\d+\s*,\s*\d+\s*(,\s*[\d.]+\s*)?\)$/i.test(e))return!0;if(/^hsla?\(\s*\d+\s*,\s*\d+%\s*,\s*\d+%\s*(,\s*[\d.]+\s*)?\)$/i.test(e))return!0;return["red","blue","green","yellow","orange","purple","pink","brown","black","white","gray","grey","cyan","magenta","lime","maroon","navy","olive","teal","silver","gold","indigo","violet","transparent","currentColor","inherit","initial","unset"].includes(e.toLowerCase())}static isValidDimensionInput(e){if(!e)return!1;if(this.isTemplate(e)||"string"==typeof e&&e.includes("."))return!0;if("number"==typeof e)return!0;if("string"!=typeof e)return!1;const t=e.match(/^(\d+(?:\.\d+)?)px$/i);if(t){const e=parseFloat(t[1]);return e>=0&&e<=1e4}const i=e.match(/^(\d+(?:\.\d+)?)%$/i);if(i){const e=parseFloat(i[1]);return e>=0&&e<=1e3}const s=["em","rem","vh","vw","vmin","vmax","ch","ex"];for(const r of s){const t=new RegExp(`^(\\d+(?:\\.\\d+)?)${r}$`,"i"),i=e.match(t);if(i){const e=parseFloat(i[1]);return e>=0&&e<=1e3}}return["auto","fit-content","min-content","max-content"].includes(e.toLowerCase())}static isValidAspectRatioInput(e){if(!e)return!1;if(this.isTemplate(e)||"string"==typeof e&&e.includes("."))return!0;if("string"!=typeof e)return!1;const t=e.match(/^(\d+(?:\.\d+)?)\/(\d+(?:\.\d+)?)$/);if(t){const e=parseFloat(t[1]),i=parseFloat(t[2]);return e>0&&i>0&&e<=20&&i<=20}return!1}static isValidNumberInput(e,t=-1/0,i=1/0){if(null==e)return!1;if("string"==typeof e){if(this.isTemplate(e)||e.includes("."))return!0;const s=parseFloat(e);return!isNaN(s)&&s>=t&&s<=i}return"number"==typeof e&&!isNaN(e)&&e>=t&&e<=i}static isValidBooleanInput(e){return"boolean"==typeof e}static isValidTextInput(e){if(!e)return!0;if(this.isTemplate(e)||"string"==typeof e&&e.includes("."))return!0;if("string"!=typeof e)return!1;return![/<script/i,/javascript:/i,/vbscript:/i,/on\w+\s*=/i,/<iframe/i,/<object/i,/<embed/i,/<form/i].some(t=>t.test(e))}static isValidStylesInput(e){if(!e||"object"!=typeof e)return!1;const t=["card","title","subtitle","progress_circle"],i=Object.keys(e);return!!i.every(e=>t.includes(e))&&i.every(t=>Array.isArray(e[t]))}static isTemplate(e){return"string"==typeof e&&e.includes("{{")&&e.includes("}}")}static isValidEntityId(e){if(!e||"string"!=typeof e)return!1;if(this.isTemplate(e))return!0;return/^[a-z_]+\.[a-z0-9_]+$/.test(e)}}class ve{constructor(){this.templateResults=new Map,this.templateCacheLimit=100}async evaluateTemplate(e,t){if(!t||!e)return e;const i=e;if(this.templateResults.has(i)){const e=this.templateResults.get(i);if(e&&Date.now()-e.timestamp<5e3)return e.result}try{if(!this.isValidTemplate(e))throw new Error("Invalid template format");const s=await t.callApi("POST","template",{template:e});if("unknown"===s||"unavailable"===s||""===s||null===s){const t=this.extractFallbackFromTemplate(e);if(t&&t!==e)return this.templateResults.set(i,{result:t,timestamp:Date.now()}),this.enforceTemplateCacheLimit(),t}return this.templateResults.set(i,{result:s,timestamp:Date.now()}),this.enforceTemplateCacheLimit(),s}catch(s){const t=this.extractFallbackFromTemplate(e);return this.templateResults.set(i,{result:t,timestamp:Date.now()}),this.enforceTemplateCacheLimit(),t}}extractFallbackFromTemplate(e){if(!e||"string"!=typeof e)return e;try{const t=e.replace(/^\{\{\s*/,"").replace(/\s*\}\}$/,"").trim(),i=/^(.+?)\s+or\s+['"`]([^'"`]+)['"`]$/,s=t.match(i);if(s&&s[2])return s[2];const r=/^(.+?)\s+or\s+(.+?)\s+or\s+['"`]([^'"`]+)['"`]$/,a=t.match(r);if(a&&a[3])return a[3];const o=/^['"`]([^'"`]+)['"`]\s+if\s+(.+?)\s+else\s+['"`]([^'"`]+)['"`]$/,n=t.match(o);if(n&&n[3])return n[3];const l=/^(.+?)\s+if\s+(.+?)\s+else\s+['"`]([^'"`]+)['"`]$/,c=t.match(l);return c&&c[3]?c[3]:"Unavailable"}catch(t){return"Template Error"}}isTemplate(e){return"string"==typeof e&&e.includes("{{")&&e.includes("}}")}isValidTemplate(e){if(!e||"string"!=typeof e)return!1;if(!e.includes("{{")||!e.includes("}}"))return!1;if((e.match(/\{\{/g)||[]).length!==(e.match(/\}\}/g)||[]).length)return!1;return!!e.replace(/\{\{\s*/,"").replace(/\s*\}\}/,"").trim()}async resolveValue(e){var t,i;if(!e)return;if(this.isTemplate(e)){const i=(null===(t=this.card)||void 0===t?void 0:t.hass)||null;return await this.evaluateTemplate(e,i)||void 0}const s=null===(i=this.card)||void 0===i?void 0:i.hass;if("string"==typeof e&&e.includes(".")&&s&&s.states[e]){const t=s.states[e];if(!t)return;return t.state}return e}clearTemplateCache(){this.templateResults.clear()}enforceTemplateCacheLimit(){if(this.templateResults.size<=this.templateCacheLimit)return;const e=Array.from(this.templateResults.entries()).sort((e,t)=>e[1].timestamp-t[1].timestamp),t=e.length-this.templateCacheLimit;for(let i=0;i<t;i++)this.templateResults.delete(e[i][0])}hasTemplatesInConfig(e){if(!e)return!1;return["target_date","creation_date","title","subtitle","color","background_color","progress_color","primary_color","secondary_color"].some(t=>e[t]&&this.isTemplate(e[t]))}escapeHtml(e){return null==e||void 0===e?"":String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}}class ye{constructor(e,t){this.templateService=e,this.dateParser=t,this.timeRemaining={months:0,days:0,hours:0,minutes:0,seconds:0,total:0},this.expired=!1,this.lastAlexaTimerData=null}_calculateCalendarMonths(e,t){if(t<=e)return{months:0,remainingMs:0};let i=0;const s=new Date(e);for(;;){const e=new Date(s);if(e.setMonth(e.getMonth()+1),!(e<=t))break;i++,s.setMonth(s.getMonth()+1)}return{months:i,remainingMs:t.getTime()-s.getTime()}}async updateCountdown(e,t){try{if(e.timer_entity&&t){const i=ge.getTimerData(e.timer_entity,t);if(i)return this.timeRemaining=this._timerDataToCountdownState(i),this.expired=ge.isTimerExpired(i),this.timeRemaining}if(!e.timer_entity&&(e.auto_discover_alexa||e.auto_discover_google)&&t){let i=[];if(e.auto_discover_alexa){const e=ge.discoverAlexaTimers(t);i.push(...e)}if(e.auto_discover_google){const e=ge.discoverGoogleTimers(t);i.push(...e)}if(i.length>0){let e=i.find(e=>{const i=ge.getTimerData(e,t);return i&&i.isActive});if(e||(e=i.find(e=>{const i=ge.getTimerData(e,t);return i&&i.isPaused})),e||(e=i.find(e=>{const i=ge.getTimerData(e,t);return i&&i.finished})),e){const i=ge.getTimerData(e,t);if(i)return this.lastAlexaTimerData=i,this.timeRemaining=this._timerDataToCountdownState(i),this.expired=ge.isTimerExpired(i),this.timeRemaining}if(this.lastAlexaTimerData&&ge.isTimerExpired(this.lastAlexaTimerData))return this.timeRemaining=this._timerDataToCountdownState(this.lastAlexaTimerData),this.expired=!0,this.timeRemaining}return this.lastAlexaTimerData=null,this.timeRemaining={months:0,days:0,hours:0,minutes:0,seconds:0,total:0},this.expired=!1,this.timeRemaining}if(!e.target_date)return this.timeRemaining;const i=(new Date).getTime(),s=await this.templateService.resolveValue(e.target_date);if(!s)return this.timeRemaining;const r=this.dateParser.parseISODate(s);if(isNaN(r))return this.timeRemaining;const a=r-i;if(a>0){const{show_months:t,show_days:s,show_hours:o,show_minutes:n,show_seconds:l}=e;let c=0,d=0,u=0,m=0,h=0,p=a;if(t){const e=new Date(i),t=new Date(r),s=this._calculateCalendarMonths(e,t);c=s.months,p=s.remainingMs}if(s)d=Math.floor(p/864e5),p%=864e5;else if(t&&!s){const e=new Date(i);e.setMonth(e.getMonth()+c);const t=new Date(r),s=this._calculateCalendarMonths(e,t);c+=s.months,p=s.remainingMs}if(o)u=Math.floor(p/36e5),p%=36e5;else if((t||s)&&!o){const e=Math.floor(p/36e5);s&&(d+=Math.floor(e/24)),p%=36e5}if(n)m=Math.floor(p/6e4),p%=6e4;else if((t||s||o)&&!n){const e=Math.floor(p/6e4);o?u+=Math.floor(e/60):s&&(d+=Math.floor(e/1440)),p%=6e4}if(l)h=Math.floor(p/1e3);else if((t||s||o||n)&&!l){const e=Math.floor(p/1e3);n?m+=Math.floor(e/60):o?u+=Math.floor(e/3600):s&&(d+=Math.floor(e/86400))}this.timeRemaining={months:c,days:d,hours:u,minutes:m,seconds:h,total:a},this.expired=!1}else this.timeRemaining={months:0,days:0,hours:0,minutes:0,seconds:0,total:0},this.expired=!0;return this.timeRemaining}catch(i){return this.timeRemaining}}async calculateProgress(e,t){if(e.timer_entity&&t){const i=ge.getTimerData(e.timer_entity,t);return i?i.progress:0}if(!e.timer_entity&&(e.auto_discover_alexa||e.auto_discover_google)&&t){let i=[];if(e.auto_discover_alexa){const e=ge.discoverAlexaTimers(t);i.push(...e)}if(e.auto_discover_google){const e=ge.discoverGoogleTimers(t);i.push(...e)}if(i.length>0){let e=i.find(e=>{const i=ge.getTimerData(e,t);return i&&i.isActive});if(e||(e=i.find(e=>{const i=ge.getTimerData(e,t);return i&&i.isPaused})),e||(e=i.find(e=>{const i=ge.getTimerData(e,t);return i&&i.finished})),e){const i=ge.getTimerData(e,t);if(i)return i.progress}}}const i=await this.templateService.resolveValue(e.target_date);if(!i)return 0;const s=this.dateParser.parseISODate(i),r=Date.now();let a;if(e.creation_date){const t=await this.templateService.resolveValue(e.creation_date);a=t?this.dateParser.parseISODate(t):r}else a=r;const o=s-a;if(o<=0)return 100;const n=r-a,l=Math.min(100,Math.max(0,n/o*100));return this.expired?100:l}getMainDisplay(e,t){if(e.timer_entity&&t){const i=ge.getTimerData(e.timer_entity,t);if(i){const{hours:e,minutes:t,seconds:s}=this.timeRemaining;return i.isAlexaTimer||i.isGoogleTimer?ge.isTimerExpired(i)?{value:"ðŸ””",label:ge.getTimerSubtitle(i,!1)}:e>0?{value:e.toString(),label:1===e?"hour left":"hours left"}:t>0?{value:t.toString(),label:1===t?"minute left":"minutes left"}:{value:s.toString(),label:1===s?"second left":"seconds left"}:e>0?{value:e.toString(),label:1===e?"hour":"hours"}:t>0?{value:t.toString(),label:1===t?"minute":"minutes"}:{value:s.toString(),label:1===s?"second":"seconds"}}}if(!e.timer_entity&&(e.auto_discover_alexa||e.auto_discover_google)&&t){let i=[];if(e.auto_discover_alexa){const e=ge.discoverAlexaTimers(t);i.push(...e)}if(e.auto_discover_google){const e=ge.discoverGoogleTimers(t);i.push(...e)}if(i.length>0){let e=i.find(e=>{const i=ge.getTimerData(e,t);return i&&i.isActive});if(e||(e=i.find(e=>{const i=ge.getTimerData(e,t);return i&&i.isPaused})),e||(e=i.find(e=>{const i=ge.getTimerData(e,t);return i&&i.finished})),e){const i=ge.getTimerData(e,t);if(i){this.lastAlexaTimerData=i,this.timeRemaining=this._timerDataToCountdownState(i);const{hours:e,minutes:t,seconds:s}=this.timeRemaining;return ge.isTimerExpired(i)?{value:"ðŸ””",label:ge.getTimerSubtitle(i,!1)}:e>0?{value:e.toString(),label:1===e?"hour left":"hours left"}:t>0?{value:t.toString(),label:1===t?"minute left":"minutes left"}:{value:s.toString(),label:1===s?"second left":"seconds left"}}}if(this.lastAlexaTimerData&&ge.isTimerExpired(this.lastAlexaTimerData))return{value:"ðŸ””",label:ge.getTimerSubtitle(this.lastAlexaTimerData,!1)}}}const{show_months:i,show_days:s,show_hours:r,show_minutes:a,show_seconds:o}=e,{months:n,days:l,hours:c,minutes:d,seconds:u}=this.timeRemaining;return this.expired?e.auto_discover_alexa||e.auto_discover_google?this.lastAlexaTimerData?{value:"ðŸ””",label:ge.getTimerSubtitle(this.lastAlexaTimerData,!1)}:{value:"ðŸ””",label:"Timer complete"}:{value:"Done",label:"Completed!"}:i&&n>0?{value:n.toString(),label:1===n?"month left":"months left"}:s&&l>0?{value:l.toString(),label:1===l?"day left":"days left"}:r&&c>0?{value:c.toString(),label:1===c?"hour left":"hours left"}:a&&d>0?{value:d.toString(),label:1===d?"minute left":"minutes left"}:o&&u>=0?{value:u.toString(),label:1===u?"second left":"seconds left"}:{value:"0",label:"seconds left"}}getSubtitle(e,t,i,s=!0){const r=i||(e=>e);if(e.timer_entity&&t){const r=ge.getTimerData(e.timer_entity,t);return r?(r.isAlexaTimer||r.isGoogleTimer,ge.getTimerSubtitle(r,!1!==e.show_seconds,i,s)):"Timer not found"}if(!e.timer_entity&&(e.auto_discover_alexa||e.auto_discover_google)&&t){let r=[];if(e.auto_discover_alexa&&r.push(...ge.discoverAlexaTimers(t)),e.auto_discover_google&&r.push(...ge.discoverGoogleTimers(t)),r.length>0){let a=r.find(e=>{const i=ge.getTimerData(e,t);return i&&i.isActive});if(a||(a=r.find(e=>{const i=ge.getTimerData(e,t);return i&&i.isPaused})),a||(a=r.find(e=>{const i=ge.getTimerData(e,t);return i&&i.finished})),a){const r=ge.getTimerData(a,t);if(r)return this.lastAlexaTimerData=r,this.timeRemaining=this._timerDataToCountdownState(r),ge.getTimerSubtitle(r,!1!==e.show_seconds,i,s)}if(this.lastAlexaTimerData&&ge.isTimerExpired(this.lastAlexaTimerData))return ge.getTimerSubtitle(this.lastAlexaTimerData,!1!==e.show_seconds,i,s)}return(i||(e=>e))("timer.no_timers")}if(this.expired){const{expired_text:t=r("countdown.completed")}=e;return t}const{months:a,days:o,hours:n,minutes:l,seconds:c}=this.timeRemaining||{months:0,days:0,hours:0,minutes:0,seconds:0},{show_months:d,show_days:u,show_hours:m,show_minutes:h,show_seconds:p,compact_format:g}=e,f=[];if(d&&a>0&&f.push({value:a,unit:r(1===a?"time.month_full":"time.months_full")}),u&&o>0&&f.push({value:o,unit:r(1===o?"time.day_full":"time.days_full")}),m&&n>0&&f.push({value:n,unit:r(1===n?"time.hour_full":"time.hours_full")}),h&&l>0&&f.push({value:l,unit:r(1===l?"time.minute_full":"time.minutes_full")}),p&&c>0&&f.push({value:c,unit:r(1===c?"time.second_full":"time.seconds_full")}),0===f.length)return p?`0 ${r("time.seconds_full")}`:r("countdown.starting");if(1===f.length)return`${f[0].value} ${f[0].unit}`;if(!0===g||!1!==g&&f.length>=3){const e=f.map(e=>`${e.value}${e.unit.charAt(0)}`).join(" ");return e}return f.map(e=>`${e.value} ${e.unit}`).join(" ")}_timerDataToCountdownState(e){return{months:0,days:0,hours:Math.floor(e.remaining/3600),minutes:Math.floor(e.remaining%3600/60),seconds:Math.floor(e.remaining%60),total:1e3*e.remaining}}getTimeRemaining(){return this.timeRemaining}isExpired(){return this.expired}getAvailableAlexaTimers(e){return e?ge.discoverAlexaTimers(e):[]}getAvailableGoogleTimers(e){return e?ge.discoverGoogleTimers(e):[]}getCurrentTimerEntity(e,t){if(e.timer_entity)return e.timer_entity;if((e.auto_discover_alexa||e.auto_discover_google)&&t){let i=[];if(e.auto_discover_alexa){const e=ge.discoverAlexaTimers(t);i.push(...e)}if(e.auto_discover_google){const e=ge.discoverGoogleTimers(t);i.push(...e)}if(i.length>0){for(const e of i){const i=ge.getTimerData(e,t);if(i&&i.isActive)return e}return i[0]}}return null}}class be{constructor(){this.cache={dynamicIconSize:null,dynamicStrokeWidth:null,customStyles:null,lastConfigHash:null}}processStyles(e){return e&&Array.isArray(e)?e.map(e=>{try{return"string"==typeof e?e:"object"==typeof e&&null!==e?Object.entries(e).map(([e,t])=>`${e}: ${t}`).join("; "):""}catch(t){return""}}).join("; "):""}buildStylesObject(e){const t=JSON.stringify(e.styles||{});if(null!==this.cache.customStyles&&this.cache.lastConfigHash===t)return this.cache.customStyles;const{styles:i={}}=e;try{const e={card:this.processStyles(i.card),title:this.processStyles(i.title),subtitle:this.processStyles(i.subtitle),progress_circle:this.processStyles(i.progress_circle)};return this.cache.customStyles=e,this.cache.lastConfigHash=t,e}catch(s){return this.cache.customStyles={card:"",title:"",subtitle:"",progress_circle:""},this.cache.customStyles}}_getCardDimensions(e,t,i){const s=300,r=150;let a=s,o=r;if(e&&t){a=this.parseDimension(e)||s,o=this.parseDimension(t)||r}else if(e&&i){a=this.parseDimension(e)||s;const[t,r]=i.split("/").map(parseFloat);!isNaN(t)&&!isNaN(r)&&t>0&&(o=a*(r/t))}else if(t&&i){o=this.parseDimension(t)||r;const[e,s]=i.split("/").map(parseFloat);!isNaN(e)&&!isNaN(s)&&s>0&&(a=o*(e/s))}else if(i){const[e,t]=i.split("/").map(parseFloat);!isNaN(e)&&!isNaN(t)&&e>0&&(o=s*(t/e)),a=s}return(!a||isNaN(a)||a<=0)&&(a=s),(!o||isNaN(o)||o<=0)&&(o=r),{cardWidth:a,cardHeight:o}}calculateDynamicIconSize(e,t,i,s){const r=JSON.stringify({width:e,height:t,aspect_ratio:i,icon_size:s});if(null!==this.cache.dynamicIconSize&&this.cache.lastIconConfigHash===r)return this.cache.dynamicIconSize;try{const{cardWidth:a,cardHeight:o}=this._getCardDimensions(e,t,i),n=.4*Math.min(a,o);let l=n;if(s&&"100px"!==s){const e="string"==typeof s?parseInt(s.replace("px","")):"number"==typeof s?s:n;l=isNaN(e)?n:e}return this.cache.dynamicIconSize=Math.max(be.MIN_ICON_SIZE,Math.min(l,be.MAX_ICON_SIZE)),this.cache.lastIconConfigHash=r,this.cache.dynamicIconSize}catch(a){return this.cache.dynamicIconSize=be.MIN_ICON_SIZE,this.cache.dynamicIconSize}}calculateDynamicStrokeWidth(e,t){const i=JSON.stringify({iconSize:e,stroke_width:t});if(null!==this.cache.dynamicStrokeWidth&&this.cache.lastStrokeConfigHash===i)return this.cache.dynamicStrokeWidth;try{if(t&&"number"==typeof t)this.cache.dynamicStrokeWidth=Math.max(be.MIN_STROKE,Math.min(t,be.MAX_STROKE));else{const t=.15,i=Math.round(e*t);this.cache.dynamicStrokeWidth=Math.max(be.MIN_STROKE,Math.min(i,be.MAX_STROKE))}return this.cache.lastStrokeConfigHash=i,this.cache.dynamicStrokeWidth}catch(s){return this.cache.dynamicStrokeWidth=be.MIN_STROKE,this.cache.dynamicStrokeWidth}}calculateProportionalSizes(e,t,i){try{const{cardWidth:s,cardHeight:r}=this._getCardDimensions(e,t,i),a=45e3,o=Math.sqrt(s*r/a);return{titleSize:Math.max(1.2,Math.min(2.2,1.6*o)),subtitleSize:Math.max(.9,Math.min(1.4,1.1*o)),cardWidth:s,cardHeight:r}}catch(s){return{titleSize:1.6,subtitleSize:1.1,cardWidth:300,cardHeight:150}}}parseDimension(e){try{if("number"==typeof e)return e;if("string"!=typeof e)return null;const t=e.toLowerCase();if(t.includes("%")){const e=parseFloat(t.replace("%",""));return isNaN(e)?null:e/100*300}if(t.includes("px")){const e=parseFloat(t.replace("px",""));return isNaN(e)?null:e}const i=parseFloat(t);return isNaN(i)?null:i}catch(t){return null}}generateCardDimensionStyles(e,t,i){const s=[];if(e){const t=this._formatDimensionValue(e);t&&s.push(`width: ${t}`)}if(t){const e=this._formatDimensionValue(t);e&&s.push(`height: ${e}`)}else i&&!t&&s.push(`aspect-ratio: ${i}`);return t||i||s.push("min-height: 120px"),s}_formatDimensionValue(e){if(!e)return null;const t=String(e).trim();if(/^[\d.]+\s*(px|%|em|rem|vh|vw|vmin|vmax|ch|ex)$/i.test(t))return t;const i=parseFloat(t);return isNaN(i)?null:`${i}px`}clearCache(){this.cache={dynamicIconSize:null,dynamicStrokeWidth:null,customStyles:null,lastConfigHash:null}}getCardDimensions(e,t,i){return this._getCardDimensions(e,t,i)}}be.MIN_ICON_SIZE=40,be.MAX_ICON_SIZE=300,be.MIN_STROKE=4,be.MAX_STROKE=50;const we={en:{timer:{complete:"Timer complete",complete_with_label:"{label} timer complete",paused:"Paused",paused_with_time:"{label} timer paused - {time} left",paused_without_label:"Timer paused - {time} left",paused_alexa:"Timer paused on {device} - {time} left",ready:"Ready",ready_with_time:"Ready - {time}",no_timers:"No timers",no_timers_device:"No timers on {device}",no_timers_google:"No Google Home timers",remaining:"{time} remaining",remaining_with_label:"{time} remaining on {label} timer",remaining_with_device:"{time} remaining on {device}",paused_time_left:"Timer paused - {time} left",google_paused:"Google Home timer paused - {time} left",timer_ready:"Timer ready"},countdown:{starting:"Starting...",completed:"Completed!"},time:{hour_compact:"h",day_compact:"d",month_compact:"mo",minute_compact:"m",second_compact:"s",hour_full:"hour",hours_full:"hours",day_full:"day",days_full:"days",month_full:"month",months_full:"months",minute_full:"minute",minutes_full:"minutes",second_full:"second",seconds_full:"seconds"}},fr:{timer:{complete:"Minuteur terminÃ©",complete_with_label:"Minuteur {label} terminÃ©",paused:"En pause",paused_with_time:"Minuteur {label} en pause - {time} restant",paused_without_label:"Minuteur en pause - {time} restant",paused_alexa:"Minuteur en pause sur {device} - {time} restant",ready:"PrÃªt",ready_with_time:"PrÃªt - {time}",no_timers:"Aucun minuteur",no_timers_device:"Aucun minuteur sur {device}",no_timers_google:"Aucun minuteur Google Home",remaining:"{time} restant",remaining_with_label:"{time} restant sur le minuteur {label}",remaining_with_device:"{time} restant sur {device}",paused_time_left:"Minuteur en pause - {time} restant",google_paused:"Minuteur Google Home en pause - {time} restant",timer_ready:"Minuteur prÃªt"},countdown:{starting:"DÃ©marrage...",completed:"TerminÃ©!"},time:{hour_compact:"h",day_compact:"j",month_compact:"mo",minute_compact:"min",second_compact:"s",hour_full:"heure",hours_full:"heures",day_full:"jour",days_full:"jours",month_full:"mois",months_full:"mois",minute_full:"minute",minutes_full:"minutes",second_full:"seconde",seconds_full:"secondes"}},de:{timer:{complete:"Timer abgelaufen",complete_with_label:"Timer {label} abgelaufen",paused:"Pausiert",paused_with_time:"Timer {label} pausiert - {time} verbleibend",paused_without_label:"Timer pausiert - {time} verbleibend",paused_alexa:"Timer pausiert auf {device} - {time} verbleibend",ready:"Bereit",ready_with_time:"Bereit - {time}",no_timers:"Keine Timer",no_timers_device:"Keine Timer auf {device}",no_timers_google:"Keine Google Home Timer",remaining:"{time} verbleibend",remaining_with_label:"{time} verbleibend bei Timer {label}",remaining_with_device:"{time} verbleibend auf {device}",paused_time_left:"Timer pausiert - {time} verbleibend",google_paused:"Google Home Timer pausiert - {time} verbleibend",timer_ready:"Timer bereit"},countdown:{starting:"Startet...",completed:"Abgeschlossen!"},time:{hour_compact:"Std",day_compact:"T",month_compact:"Mon",minute_compact:"Min",second_compact:"s",hour_full:"Stunde",hours_full:"Stunden",day_full:"Tag",days_full:"Tage",month_full:"Monat",months_full:"Monate",minute_full:"Minute",minutes_full:"Minuten",second_full:"Sekunde",seconds_full:"Sekunden"}},es:{timer:{complete:"Temporizador finalizado",complete_with_label:"Temporizador {label} finalizado",paused:"Pausado",paused_with_time:"Temporizador {label} pausado - {time} restante",paused_without_label:"Temporizador pausado - {time} restante",paused_alexa:"Temporizador pausado en {device} - {time} restante",ready:"Listo",ready_with_time:"Listo - {time}",no_timers:"Sin temporizadores",no_timers_device:"Sin temporizadores en {device}",no_timers_google:"Sin temporizadores de Google Home",remaining:"{time} restante",remaining_with_label:"{time} restante en temporizador {label}",remaining_with_device:"{time} restante en {device}",paused_time_left:"Temporizador pausado - {time} restante",google_paused:"Temporizador de Google Home pausado - {time} restante",timer_ready:"Temporizador listo"},countdown:{starting:"Iniciando...",completed:"Â¡Completado!"},time:{hour_compact:"h",day_compact:"d",month_compact:"mes",minute_compact:"min",second_compact:"s",hour_full:"hora",hours_full:"horas",day_full:"dÃ­a",days_full:"dÃ­as",month_full:"mes",months_full:"meses",minute_full:"minuto",minutes_full:"minutos",second_full:"segundo",seconds_full:"segundos"}},it:{timer:{complete:"Timer completato",complete_with_label:"Timer {label} completato",paused:"In pausa",paused_with_time:"Timer {label} in pausa - {time} rimanente",paused_without_label:"Timer in pausa - {time} rimanente",paused_alexa:"Timer in pausa su {device} - {time} rimanente",ready:"Pronto",ready_with_time:"Pronto - {time}",no_timers:"Nessun timer",no_timers_device:"Nessun timer su {device}",no_timers_google:"Nessun timer Google Home",remaining:"{time} rimanente",remaining_with_label:"{time} rimanente sul timer {label}",remaining_with_device:"{time} rimanente su {device}",paused_time_left:"Timer in pausa - {time} rimanente",google_paused:"Timer Google Home in pausa - {time} rimanente",timer_ready:"Timer pronto"},countdown:{starting:"Avvio...",completed:"Completato!"},time:{hour_compact:"h",day_compact:"g",month_compact:"mo",minute_compact:"min",second_compact:"s",hour_full:"ora",hours_full:"ore",day_full:"giorno",days_full:"giorni",month_full:"mese",months_full:"mesi",minute_full:"minuto",minutes_full:"minuti",second_full:"secondo",seconds_full:"secondi"}},nl:{timer:{complete:"Timer klaar",complete_with_label:"Timer {label} klaar",paused:"Gepauzeerd",paused_with_time:"Timer {label} gepauzeerd - {time} resterend",paused_without_label:"Timer gepauzeerd - {time} resterend",paused_alexa:"Timer gepauzeerd op {device} - {time} resterend",ready:"Klaar",ready_with_time:"Klaar - {time}",no_timers:"Geen timers",no_timers_device:"Geen timers op {device}",no_timers_google:"Geen Google Home timers",remaining:"{time} resterend",remaining_with_label:"{time} resterend op timer {label}",remaining_with_device:"{time} resterend op {device}",paused_time_left:"Timer gepauzeerd - {time} resterend",google_paused:"Google Home timer gepauzeerd - {time} resterend",timer_ready:"Timer klaar"},countdown:{starting:"Starten...",completed:"Voltooid!"},time:{hour_compact:"u",day_compact:"d",month_compact:"mnd",minute_compact:"min",second_compact:"s",hour_full:"uur",hours_full:"uren",day_full:"dag",days_full:"dagen",month_full:"maand",months_full:"maanden",minute_full:"minuut",minutes_full:"minuten",second_full:"seconde",seconds_full:"seconden"}}};function xe(e,t){try{const i=e.split(".");let s=we[t];if(!s)return;for(const e of i)if(s=s[e],void 0===s)return;return"string"==typeof s?s:void 0}catch(O){return}}function Te(e){return function(t,i={}){var s,r;let a=xe(t,null!==(r=null===(s=null==e?void 0:e.locale)||void 0===s?void 0:s.language)&&void 0!==r?r:"en");return a||(a=xe(t,"en")),a?function(e,t={}){return e?e.replace(/\{([^}]+)\}/g,(e,i)=>{var s;return String(null!==(s=t[i])&&void 0!==s?s:`{${i}}`)}):""}(a,i):t}}class $e{constructor(e){}get _$AU(){return this._$AM._$AU}_$AT(e,t,i){this._$Ct=e,this._$AM=t,this._$Ci=i}_$AS(e,t){return this.update(e,t)}update(e,t){return this.render(...t)}}const Se=(e,t,i,s)=>{!function(e,t,i){const s=new CustomEvent(t,{bubbles:!0,cancelable:!0,composed:!0,detail:i});e.dispatchEvent(s)}(e,"hass-action",{config:i,action:s})},Ae=(e,t)=>{const i=(()=>{const e=document.body;if(e.querySelector("action-handler"))return e.querySelector("action-handler");const t=document.createElement("action-handler");return e.appendChild(t),t})();i&&i.bind(e,t)},De=(e=>(...t)=>({_$litDirective$:e,values:t}))(class extends $e{update(e,[t]){return Ae(e.element,t),j}render(e){return j}});function Ce(e){return void 0!==e&&"none"!==e.action}class Me extends oe{constructor(){super(...arguments),this.errors=[],this.title="Configuration Issues"}static get styles(){return o`
      :host {
        display: block;
        font-family: var(--font-family, -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif);
      }

      .error-container {
        background: #332022;
        border: 1px solid #582533ff;
        border-radius: 1px;
        padding: 16px;
        margin: 8px;
        color: #ffffff;
      }

      .error-list {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      .error-item {
        margin-bottom: 8px;
        line-height: 1.4;
      }

      .error-field {
        font-weight: 600;
        color: #D74133;
      }
    `}render(){if(!this.errors||0===this.errors.length)return V``;const e=this.errors.filter(e=>"critical"===e.severity||"warning"===e.severity);return 0===e.length?V``:V`
      <div class="error-container">
        <ul class="error-list">
          ${e.map(e=>V`
            <li class="error-item">
              <span class="error-field">${e.field}:</span> ${e.message}
            </li>
          `)}
        </ul>
      </div>
    `}}e([de({type:Array})],Me.prototype,"errors",void 0),e([de({type:String})],Me.prototype,"title",void 0),customElements.define("error-display-beta",Me);class Ee extends oe{static async getConfigElement(){return document.createElement("timeflow-card-beta-editor")}static get styles(){return o`
      :host {
        display: block;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
        color: var(--primary-text-color, #222);
        --progress-color: var(--progress-color, #4caf50);
      }
      
      /* FIXED: Set initial background immediately to prevent white flash */
      ha-card {
        display: flex;
        flex-direction: column;
        padding: 0;
        /* Use HA theme border-radius: defaults to 12px, respects user theme */
        border-radius: var(--ha-card-border-radius, var(--ha-border-radius-lg, 12px));
        position: relative;
        overflow: hidden;
        /* Use HA theme background: respects user theme changes */
        background: var(--ha-card-background, var(--ha-card-background-color, #1a1a1a));
        /* Use HA theme box-shadow: respects user theme */
        box-shadow: var(--ha-card-box-shadow, 0 2px 10px rgba(0, 0, 0, 0.1));
        /* Use HA theme border: respects user theme */
        border-width: var(--ha-card-border-width, 1px);
        border-style: solid;
        border-color: var(--ha-card-border-color, var(--divider-color, #e0e0e0));
        /* REMOVED: transition that causes flash - only animate specific properties if needed */
        /* transition: background-color 0.3s ease; */
        min-height: 120px; /* Prevent layout shift */
        user-select: none; /* Prevent text selection during interactions */
      }
      
      /* Make card interactive when actions are configured */
      ha-card[actionHandler] {
        cursor: pointer;
      }
      
      ha-card[actionHandler]:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }
      
      ha-card[actionHandler]:active {
        transform: translateY(0);
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      
      /* Error message styling */
      .error {
        color: #721c24;
        padding: 12px;
        border-radius: 16px;
        white-space: pre-wrap;
        word-break: break-word;
      }
      
      /* FIXED: Only show card after initialization to prevent white flash */
      ha-card:not(.initialized) {
        opacity: 0;
      }
      
      ha-card.initialized {
        opacity: 1;
        transition: opacity 0.2s ease-in;
      }
      
      ha-card.expired {
        animation: celebration 0.8s ease-in-out;
      }
      
      .card-content {
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        padding: 20px;
        height: 100%;
        /* FIXED: Ensure content has proper background inheritance */
        background: inherit;
      }
      
      .header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 0;
      }
      
      .title-section {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 2px;
      }
      
      .title {
        font-size: var(--timeflow-title-size, 1.5rem);
        font-weight: 500;
        margin: 0;
        opacity: 0.9;
        line-height: 1.3;
        letter-spacing: -0.01em;
        color: var(--timeflow-card-text-color, inherit);
      }
      
      .subtitle {
        font-size: var(--timeflow-subtitle-size, 1rem);
        opacity: 0.65;
        margin: 0;
        font-weight: 400;
        line-height: 1.2;
        color: var(--timeflow-card-text-color, inherit);
      }
      
      .progress-section {
        flex-shrink: 0;
        margin-left: auto;
      }
      
      .content {
        display: flex;
        align-items: flex-end;
        justify-content: flex-end;
        margin-top: auto;
        padding-top: 12px;
      }
      
      .progress-circle {
        opacity: 0.9;
      }
      
      @keyframes celebration {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
      }
      
      /* Dark mode support */
      @media (prefers-color-scheme: dark) {
        ha-card {
          box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }
      }
    `}constructor(){super(),this.hass=null,this.config=this.getStubConfig(),this._resolvedConfig=this.getStubConfig(),this._progress=0,this._countdown={months:0,days:0,hours:0,minutes:0,seconds:0,total:0},this._expired=!1,this._validationResult=null,this._initialized=!1,this._localize=null,this._timerId=null,this.templateService=new ve,this.countdownService=new ye(this.templateService,fe),this.styleManager=new be;const e=this.getStubConfig();this.config=e,this._resolvedConfig=e}static getStubConfig(){return{type:"custom:timeflow-card-beta",target_date:"2026-12-31T23:59:59",creation_date:"2025-12-31T23:59:59",timer_entity:"",title:"New Year Countdown",show_days:!0,show_hours:!0,show_minutes:!0,show_seconds:!0,progress_color:"",background_color:"",stroke_width:15,icon_size:100,expired_animation:!1,expired_text:""}}getStubConfig(){return Ee.getStubConfig()}setConfig(e){try{const t=_e.validateConfig(e);if(this._validationResult=t,t.hasCriticalErrors)this.config=t.safeConfig||this.getStubConfig(),this._resolvedConfig={...this.config};else{if(t.hasWarnings)return this.config={...e},this._resolvedConfig={...e},this._initialized=!0,void this.requestUpdate();this.config={...e},this._resolvedConfig={...e}}this._initialized=!1,this.templateService.clearTemplateCache(),this.styleManager.clearCache(),this._updateCountdownAndRender().then(()=>{this._initialized=!0,this.requestUpdate()})}catch(t){this._validationResult={isValid:!1,errors:[{field:"config",message:t.message||"Unexpected configuration error",severity:"critical",suggestion:"Check console for details and verify your configuration syntax.",value:e}],hasCriticalErrors:!0,hasWarnings:!1,safeConfig:this.getStubConfig()},this.config=this.getStubConfig(),this._resolvedConfig={...this.config},this._initialized=!0,this.requestUpdate()}}firstUpdated(){this.templateService.card=this,this._updateCountdownAndRender().then(()=>{this._initialized=!0,this.requestUpdate(),this._startCountdownUpdates()})}disconnectedCallback(){super.disconnectedCallback(),this._stopCountdownUpdates()}updated(e){(e.has("hass")||e.has("config"))&&(this.hass&&(this._localize=Te(this.hass)),this.templateService.clearTemplateCache(),this._updateCountdownAndRender())}_startCountdownUpdates(){this._stopCountdownUpdates(),this._timerId=setInterval(()=>{this._updateCountdownAndRender()},1e3)}_stopCountdownUpdates(){this._timerId&&(clearInterval(this._timerId),this._timerId=null)}async _updateCountdownAndRender(){var e;if(null===(e=this._validationResult)||void 0===e?void 0:e.hasCriticalErrors)return;const t={...this.config},i=["target_date","creation_date","timer_entity","title","subtitle","text_color","background_color","progress_color","primary_color","secondary_color","expired_text"];for(const s of i)if("string"==typeof t[s]&&this.templateService.isTemplate(t[s])){const e=await this.templateService.resolveValue(t[s]);t[s]=e||void 0}this._resolvedConfig=t,await this.countdownService.updateCountdown(t,this.hass),this._countdown={...this.countdownService.getTimeRemaining()},this._expired=this.countdownService.isExpired(),this._progress=await this.countdownService.calculateProgress(t,this.hass),this.requestUpdate()}render(){return this._validationResult&&!this._validationResult.isValid?V`
        <error-display-beta
          .errors="${this._validationResult.errors}"
          .title="${this._validationResult.hasCriticalErrors?"Configuration Error":"Configuration Issues"}"
        ></error-display-beta>
      `:this._renderCard()}_renderCard(){var e;const{title:t,subtitle:i,text_color:s,background_color:r,progress_color:a,stroke_width:o,icon_size:n,expired_animation:l=!0,expired_text:c="",width:d,height:u,aspect_ratio:m,show_months:h,show_days:p,show_hours:g,show_minutes:f,show_seconds:_,compact_format:v}=this._resolvedConfig,y=[h,p,g,f,_].filter(e=>!0===e).length,b=!0===v||!1!==v&&y>=3,w=r||"var(--ha-card-background, var(--ha-card-background-color, #1a1a1a))",x=s||"var(--primary-text-color, #fff)",T=a||s||"var(--progress-color, #4caf50)",$=this.styleManager.calculateDynamicIconSize(d,u,m,n),S=this.styleManager.calculateDynamicStrokeWidth($,o),A=this.styleManager.calculateProportionalSizes(d,u,m),D=this.styleManager.generateCardDimensionStyles(d,u,m),C=[`background: ${w}`,`color: ${x}`,`--timeflow-card-background-color: ${w}`,`--timeflow-card-text-color: ${x}`,`--timeflow-card-progress-color: ${T}`,`--timeflow-card-icon-size: ${$}px`,`--timeflow-card-stroke-width: ${S}`,`--timeflow-title-size: ${A.titleSize}rem`,`--timeflow-subtitle-size: ${A.subtitleSize}rem`,`--progress-text-color: ${x}`,...D].join("; "),M=this._resolvedConfig.timer_entity||this._resolvedConfig.auto_discover_alexa||this._resolvedConfig.auto_discover_google?!1!==v:b;let E;if(this._resolvedConfig.timer_entity&&this.hass){const e=ge.getTimerData(this._resolvedConfig.timer_entity,this.hass);E=e?this._expired&&(e.isAlexaTimer||e.isGoogleTimer)?ge.getTimerSubtitle(e,!1!==this._resolvedConfig.show_seconds,this._localize||void 0,M):this._expired?c||this.countdownService.getSubtitle(this._resolvedConfig,this.hass,this._localize||void 0,M):i||ge.getTimerSubtitle(e,!1!==this._resolvedConfig.show_seconds,this._localize||void 0,M):this._expired?c||this.countdownService.getSubtitle(this._resolvedConfig,this.hass,this._localize||void 0,M):i||this.countdownService.getSubtitle(this._resolvedConfig,this.hass,this._localize||void 0,M)}else E=this._resolvedConfig.auto_discover_alexa?i||this.countdownService.getSubtitle(this._resolvedConfig,this.hass,this._localize||void 0,M):this._expired?c||this.countdownService.getSubtitle(this._resolvedConfig,this.hass,this._localize||void 0,M):i||this.countdownService.getSubtitle(this._resolvedConfig,this.hass,this._localize||void 0,M);let I=t;(null==I||"string"==typeof I&&""===I.trim())&&(I=this._resolvedConfig.timer_entity&&this.hass?ge.getTimerTitle(this._resolvedConfig.timer_entity,this.hass):this._resolvedConfig.auto_discover_alexa||this._resolvedConfig.auto_discover_google?"Countdown Timer":this._expired?c:"Countdown Timer");const N=[this._initialized?"initialized":"",this._expired&&l?"expired":""].filter(Boolean).join(" "),k={...this._resolvedConfig};k.timer_entity&&!k.entity&&(k.entity=k.timer_entity),k.entity&&!k.tap_action&&(k.tap_action={action:"more-info"}),null===(e=k.tap_action)||void 0===e||e.action;const R=k.tap_action||k.hold_action||k.double_tap_action;return V`
      <ha-card 
        class="${N}" 
        style="${C}"
        ?actionHandler=${R}
        .actionHandler=${R?(z=k,De({hasHold:Ce(z.hold_action),hasDoubleClick:Ce(z.double_tap_action)})):void 0}
        @action=${R&&this.hass?function(e,t){return e=>{Se(e.target,0,t,e.detail.action)}}(this.hass,k):void 0}
      >
        <div class="card-content">
          <header class="header">
            <div class="title-section">
              <h2 class="title" aria-live="polite">${I}</h2>
              <p class="subtitle" aria-live="polite">${E}</p>
            </div>
          </header>
          
          <div class="content" role="group" aria-label="Countdown Progress">
            <div class="progress-section">
              <progress-circle-beta
                class="progress-circle"
                .progress="${this._progress}"
                .color="${T}"
                .size="${$}"
                .strokeWidth="${S}"
                aria-label="Countdown progress: ${Math.round(this._progress)}%"
              ></progress-circle-beta>
            </div>
          </div>
        </div>
      </ha-card>
    `;var z}getCardSize(){const{aspect_ratio:e="2/1",height:t}=this.config;if(t){const e=parseInt("string"==typeof t?t:t.toString());return e<=100?1:e<=150?2:e<=200?3:4}if(e){const[t,i]=e.split("/").map(Number);if(!t||!i)return 3;const s=i/t;return s>=1.5?4:s>=1?3:2}return 3}static get version(){return"1.3"}}e([de({type:Object})],Ee.prototype,"hass",void 0),e([de({type:Object})],Ee.prototype,"config",void 0),e([ue()],Ee.prototype,"_resolvedConfig",void 0),e([ue()],Ee.prototype,"_progress",void 0),e([ue()],Ee.prototype,"_countdown",void 0),e([ue()],Ee.prototype,"_expired",void 0),e([ue()],Ee.prototype,"_validationResult",void 0),e([ue()],Ee.prototype,"_initialized",void 0),e([ue()],Ee.prototype,"_localize",void 0);class Ie extends oe{static get styles(){return o`
      :host {
        display: inline-block;
        vertical-align: middle;
      }
      .progress-wrapper {
        position: relative;
      }
      svg {
        display: block;
        margin: 0 auto;
      }
      .updating {
        transition: stroke-dashoffset 0.3s ease;
      }
    `}constructor(){super(),this.progress=0,this.color="#4CAF50",this.size=100,this.strokeWidth=15,this.progress=0,this.color="#4CAF50",this.size=100,this.strokeWidth=15}updated(e){var t;if(e.has("progress")){const e=null===(t=this.renderRoot)||void 0===t?void 0:t.querySelector(".progress-bar");e&&(e.classList.add("updating"),setTimeout(()=>{e&&e.classList.remove("updating")},400))}}updateProgress(e,t=!0){var i;if(t)this.progress=e;else{const t=null===(i=this.renderRoot)||void 0===i?void 0:i.querySelector(".progress-bar");this.progress=e,t&&(t.style.transition="none"),setTimeout(()=>{t&&(t.style.transition="")},20)}}getProgress(){return this.progress}render(){const e=Math.max(0,Math.min(100,Number(this.progress)||0)),t=Number(this.size)||100,i=Number(this.strokeWidth)||15,s=(t-i)/2,r=2*Math.PI*s,a=r-e/100*r;return V`
      <div class="progress-wrapper" style="width:${t}px; height:${t}px;">
        <svg
          class="progress-circle-beta"
          height="${t}" width="${t}"
          style="overflow:visible;"
        >
          <circle
            class="progress-bg"
            cx="${t/2}" cy="${t/2}"
            r="${s}"
            fill="none"
            stroke="#FFFFFF1A"
            stroke-width="${i}"
          ></circle>
          <circle
            class="progress-bar"
            cx="${t/2}" cy="${t/2}"
            r="${s}"
            fill="none"
            stroke="${this.color}"
            stroke-width="${i}"
            stroke-linecap="round"
            style="
              stroke-dasharray: ${r};
              stroke-dashoffset: ${a};
              transition: stroke-dashoffset 0.3s ease;
              transform: rotate(-90deg);
              transform-origin: ${t/2}px ${t/2}px;
            "
          ></circle>
        </svg>
      </div>
    `}}e([de({type:Number})],Ie.prototype,"progress",void 0),e([de({type:String})],Ie.prototype,"color",void 0),e([de({type:Number})],Ie.prototype,"size",void 0),e([de({type:Number})],Ie.prototype,"strokeWidth",void 0);class Ne extends oe{constructor(){super(...arguments),this.hass=null,this._config={type:"custom:timeflow-card-beta"},this._targetDateTemplateMode=!1,this._creationDateTemplateMode=!1}static get styles(){return o`
            .section-header {
                font-weight: 500;
                font-size: 14px;
                color: var(--primary-text-color);
                margin: 16px 0 8px 0;
                padding-bottom: 4px;
                border-bottom: 1px solid var(--divider-color);
            }
            .section-header:first-of-type {
                margin-top: 8px;
            }
            ha-form {
                display: block;
            }
            
            /* Date field with mode toggle */
            .date-field-container {
                display: flex;
                flex-direction: column;
                gap: 4px;
                margin-bottom: 16px;
            }
            .date-field-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            .date-field-label {
                font-weight: 500;
                font-size: 14px;
                color: var(--primary-text-color);
            }
            .mode-toggle {
                display: flex;
                align-items: center;
                gap: 6px;
                font-size: 12px;
                color: var(--secondary-text-color);
                cursor: pointer;
                padding: 4px 8px;
                border-radius: 4px;
                background: var(--secondary-background-color);
                border: none;
            }
            .mode-toggle:hover {
                background: var(--primary-color);
                color: var(--text-primary-color);
            }
            .mode-toggle ha-icon {
                --mdc-icon-size: 16px;
            }
            .date-helper {
                font-size: 12px;
                color: var(--secondary-text-color);
                margin-top: 4px;
            }
            ha-textfield, input[type="datetime-local"] {
                width: 100%;
            }
            input[type="datetime-local"] {
                padding: 12px;
                border: 1px solid var(--divider-color);
                border-radius: 4px;
                background: var(--card-background-color);
                color: var(--primary-text-color);
                font-size: 14px;
            }
            input[type="datetime-local"]:focus {
                outline: none;
                border-color: var(--primary-color);
            }
            .date-fields-section {
                display: flex;
                flex-direction: column;
                gap: 16px;
                padding: 16px 0;
            }
        `}setConfig(e){this._config={...e};const t=e.target_date||"",i=e.creation_date||"";this._targetDateTemplateMode=this._isTemplate(t),this._creationDateTemplateMode=this._isTemplate(i)}_isTemplate(e){return e.includes("{{")||e.includes("{%")}_convertToDatetimeLocal(e){if(!e||this._isTemplate(e))return"";try{const t=new Date(e);if(isNaN(t.getTime()))return"";const i=t.getFullYear(),s=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0"),a=String(t.getHours()).padStart(2,"0");return`${i}-${s}-${r}T${a}:${String(t.getMinutes()).padStart(2,"0")}`}catch{return""}}_convertFromDatetimeLocal(e){return e?e+":00":""}_fireConfigChanged(e){this.dispatchEvent(new CustomEvent("config-changed",{detail:{config:e},bubbles:!0,composed:!0}))}_formChanged(e){var t,i;const s=(null===(t=e.detail)||void 0===t?void 0:t.value)||{},r={...this._config||{},...s,type:(null===(i=this._config)||void 0===i?void 0:i.type)||"custom:timeflow-card-beta"};this._config=r,this._fireConfigChanged(r)}_computeHelper(e){return{timer_entity:"Select a timer, sensor, or input_datetime entity",target_date:'ISO date, entity, or template: "2024-12-31T23:59:59", "{{ states(\'input_datetime.deadline\') }}"',creation_date:"Start date for progress calculation (optional)",auto_discover_alexa:"Automatically find active Alexa timers",auto_discover_google:"Automatically find active Google Home timers",alexa_device_filter:'Comma-separated list of Alexa device names or IDs to filter timers (e.g., "Kitchen, Living Room")',prefer_labeled_timers:"Prefer timers with labels over unnamed ones",title:"Card title - supports templates: \"{{ states('sensor.event_name') }}\"",subtitle:"Shows time remaining by default; only set for custom text",expired_text:"Text shown when countdown completes",compact_format:'"2d 5h 30m" vs "2 days 5 hours 30 minutes"',progress_color:"Progress circle color (hex, name, rgb, or template)",background_color:"Card background color",text_color:"Text color for title and countdown",width:'Card width (e.g., "300px", "100%", "20em")',height:'Card height (e.g., "200px", "auto")',aspect_ratio:'Width:height ratio (e.g., "16/9", "4/3", "1/1")',stroke_width:"Thickness of the progress circle ring",icon_size:"Size of the progress circle"}[e.name]||""}_computeLabel(e){var t;if(e.label)return e.label;const i={timer_entity:"Timer Entity",target_date:"Target Date/Time",creation_date:"Start Date (for progress)",auto_discover_alexa:"Auto-discover Alexa Timers",auto_discover_google:"Auto-discover Google Timers",alexa_device_filter:"Alexa Device Filter",prefer_labeled_timers:"Prefer Labeled Timers",show_alexa_device:"Show Alexa Device Name",show_days:"Days",show_hours:"Hours",show_minutes:"Minutes",show_seconds:"Seconds",show_months:"Months",compact_format:"Compact Format",expired_animation:"Expired Animation",expired_text:"Expired Text",progress_color:"Progress Color",background_color:"Background Color",text_color:"Text Color",stroke_width:"Stroke Width",icon_size:"Circle Size",aspect_ratio:"Aspect Ratio"};if(i[e.name])return i[e.name];const s=(null!==(t=e.name)&&void 0!==t?t:"").toString();return s?s.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "):""}_renderDateField(e,t,i,s,r){const a=this._config[e]||"";return V`
            <div class="date-field-container">
                <div class="date-field-header">
                    <span class="date-field-label">${t}</span>
                    <button 
                        class="mode-toggle" 
                        @click=${r}
                        title=${s?"Switch to date picker":"Switch to template/Jinja mode"}
                    >
                        <ha-icon icon=${s?"mdi:calendar":"mdi:code-braces"}></ha-icon>
                        ${s?"Picker":"Template"}
                    </button>
                </div>
                
                ${s?V`
                        <ha-textfield
                            .value=${a}
                            .placeholder=${"{{ states('input_datetime.my_date') }}"}
                            @input=${t=>this._updateDateField(e,t.target.value)}
                        ></ha-textfield>
                        <div class="date-helper">Enter Jinja template, entity, or ISO date string</div>
                    `:V`
                        <input 
                            type="datetime-local"
                            .value=${this._convertToDatetimeLocal(a)}
                            @input=${t=>this._updateDateField(e,this._convertFromDatetimeLocal(t.target.value))}
                        />
                        <div class="date-helper">${i}</div>
                    `}
            </div>
        `}_updateDateField(e,t){const i={...this._config,[e]:t};this._config=i,this._fireConfigChanged(i)}_toggleTargetDateMode(){this._targetDateTemplateMode=!this._targetDateTemplateMode}_toggleCreationDateMode(){this._creationDateTemplateMode=!this._creationDateTemplateMode}_getEffectiveCompactFormat(){const{show_months:e,show_days:t,show_hours:i,show_minutes:s,show_seconds:r,compact_format:a}=this._config;if(void 0!==a)return a;const o=[e,t,i,s,r].filter(e=>!0===e).length;return o>=3}render(){const e={...this._config||{},compact_format:this._getEffectiveCompactFormat()};return V`
            <!-- Date Fields with Template Toggle -->
            <div class="date-fields-section">
                ${this._renderDateField("target_date","Target Date","Date/time when countdown ends",this._targetDateTemplateMode,()=>this._toggleTargetDateMode())}
                
                ${this._renderDateField("creation_date","Creation Date","Start date (defaults to now)",this._creationDateTemplateMode,()=>this._toggleCreationDateMode())}
            </div>
            
            <ha-form
                .hass=${this.hass}
                .data=${e}
                .schema=${[{name:"timer_entity",selector:{entity:{domain:["timer","sensor","input_datetime"]}}},{type:"grid",schema:[{name:"auto_discover_alexa",selector:{boolean:{}}},{name:"auto_discover_google",selector:{boolean:{}}}]},{name:"title",selector:{text:{}}},{name:"subtitle",selector:{text:{}}},{name:"expired_text",selector:{text:{}}},{type:"grid",schema:[{name:"show_months",selector:{boolean:{}}},{name:"show_days",selector:{boolean:{}}},{name:"show_hours",selector:{boolean:{}}},{name:"show_minutes",selector:{boolean:{}}},{name:"show_seconds",selector:{boolean:{}}},{name:"compact_format",selector:{boolean:{}}}]},{type:"expandable",title:"Appearance",icon:"mdi:palette",schema:[{name:"progress_color",selector:{text:{}}},{name:"background_color",selector:{text:{}}},{name:"text_color",selector:{text:{}}},{name:"expired_animation",selector:{boolean:{}}}]},{type:"expandable",title:"Layout",icon:"mdi:page-layout-body",schema:[{type:"grid",schema:[{name:"width",selector:{text:{}}},{name:"height",selector:{text:{}}}]},{name:"aspect_ratio",selector:{text:{}}}]},{type:"expandable",title:"Progress Circle",icon:"mdi:circle-slice-3",schema:[{type:"grid",schema:[{name:"stroke_width",selector:{number:{min:1,max:50,step:1}}},{name:"icon_size",selector:{number:{min:10,max:350,step:5}}}]}]},{type:"expandable",title:"Smart Assistant Options",icon:"mdi:home-assistant",schema:[{name:"alexa_device_filter",selector:{text:{}}},{name:"prefer_labeled_timers",selector:{boolean:{}}},{name:"show_alexa_device",selector:{boolean:{}}}]},{type:"expandable",title:"Tap Actions",icon:"mdi:gesture-tap",schema:[{name:"tap_action",selector:{ui_action:{}}},{name:"hold_action",selector:{ui_action:{}}},{name:"double_tap_action",selector:{ui_action:{}}}]}]}
                @value-changed=${e=>this._formChanged(e)}
                .computeLabel=${this._computeLabel}
                .computeHelper=${this._computeHelper}
            ></ha-form>
        `}}e([de({type:Object})],Ne.prototype,"hass",void 0),e([ue()],Ne.prototype,"_config",void 0),e([ue()],Ne.prototype,"_targetDateTemplateMode",void 0),e([ue()],Ne.prototype,"_creationDateTemplateMode",void 0),customElements.get("error-display-beta")||customElements.define("error-display-beta",Me),customElements.get("progress-circle-beta")||customElements.define("progress-circle-beta",Ie),customElements.get("timeflow-card-beta")||customElements.define("timeflow-card-beta",Ee),customElements.get("timeflow-card-beta-editor")||customElements.define("timeflow-card-beta-editor",Ne),window.customCards=window.customCards||[],window.customCards.push({type:"timeflow-card-beta",name:"TimeFlow Card beta",description:"A beautiful countdown timer card with progress circle for Home Assistant, using Lit",preview:!0,documentationURL:"https://github.com/Rishi8078/TimeFlow-Card"});export{Me as ErrorDisplayBeta,Ie as ProgressCircleBeta,Ee as TimeFlowCardBeta,Ne as TimeFlowCardEditorBeta};
